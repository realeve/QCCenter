var PaperParam=function(){function t(){var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=24&M=3&t=1&cache=14400";$.ajax({url:t}).done(function(t){var e=handleAjaxData(t);InitSelect("prod_ID",e)}),t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=25&M=3&t=2&cache=14400",$.ajax({url:t}).done(function(t){var e=handleAjaxData(t);InitSelect("oper_ID",e)}),initSelect2()}function e(){t(),$("input[name='rec_date']").val(today(6)),$("input[name='remark']").val("无"),$(".page-header .dropdown-quick-sidebar-toggler").hide()}function a(){return $("input[name='Reel_Code']").val().length<6||$('select[name="oper_ID"]').val()==-1||$('select[name="prod_ID"]').val()==-1}function n(){var t=[3,6,7,9,10,13,14,15,16,17],e=[19,20,21],a=$('select[name="prod_ID"]').find("option:selected").text();"103-G-7T"===a?(e.map(function(t){$(".normalPara input:nth("+t+")").parents(".form-group").show()}),$(".normalPara input:nth(15)").parent().find(".help-block").text("安全线：开窗线≥3.6mm，全埋线≥1.3mm "),$(".normalPara input:nth(17)").parent().find(".help-block").text("≤3mm ")):($(".normalPara input:nth(15)").parent().find(".help-block").text("不得低于：宽线≥1.7mm，窄线≥1.2mm "),$(".normalPara input:nth(17)").parent().find(".help-block").text("≤2mm "),e.map(function(t){$(".normalPara input:nth("+t+")").parents(".form-group").hide()}),"103-G-2A"===a?t.map(function(t){$(".normalPara input:nth("+t+")").parents(".form-group").hide()}):t.map(function(t){$(".normalPara input:nth("+t+")").parents(".form-group").show()})),$("input[name='remark']").val("无"),$("input[name='rec_date']").val(today(6)),r()}function r(){var t=$("input[name='rec_date']").val();t=t.substr(0,4)+t.substr(5,2);var e=$('select[name="prod_ID"]').val();null==e&&(e=-1);var a=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=27&M=3&tmonth="+t+"&prod="+e,n=ReadData(a);a=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=28&M=3&tmonth="+t+"&prod="+e;var r=ReadData(a);$(".grey-cascade").html("物理指标得分："+xround(n.data[0][0],2)+"，外观指标得分："+xround(r.data[0][0],2));var o=parseInt(r.data[0][0],10)+parseInt(n.data[0][0],10)-100;$('input[name="chk_ID"]').val(parseInt(r.data[0][1],10)+1),$(".list-unstyled.amounts li:nth(0)").html("<h4><strong>当前得分:</strong> 100</h4>"),$(".list-unstyled.amounts li:nth(1)").html("<strong>物理指标:</strong> "+xround(n.data[0][0],2)),$(".list-unstyled.amounts li:nth(2)").html("<strong>外观指标:</strong> "+xround(r.data[0][0],2)),$(".list-unstyled.amounts li:nth(3)").html('<h4 class="font-grey-mint"><strong>当月总分:</strong> '+xround(o,2)+"</h4>")}function o(){var t={tbl:TBL.SURFACE,score:parseFloat($(".list-unstyled.amounts li:nth(0)").text().replace("当前得分:","")),chk_ID:$('input[name="chk_ID"]').val(),reel_code:$("input[name='Reel_Code']").val(),prod_ID:$('select[name="prod_ID"]').val(),oper_ID:$('select[name="oper_ID"]').val(),rec_date:$("input[name='rec_date']").val(),remark:$("input[name='remark']").val(),utf2gbk:["remark"],record_Time:today(1)},e=["size","founder_degree","watermark","white_watermark","watermark_size","white_watermark_size","watermark_clarity","white_watermark_clarity","watermark_consistency","white_watermark_consistency","white_watermark_tile","paper_evenness","cleanliness","open_window","line_bare","line_thick","line_break","anti_fake","thick_line_stretch","wide_line_pos","k_format","commence","other"],a=JSON.stringify(t);a=a.replace("}","");var n;return $(".normalPara input").map(function(t){n=$(this).val(),""===n&&(n=0),a=a+',"'+e[t]+'":'+n}),a+="}",$.parseJSON(a)}function i(){var t=getRootPath()+"/DataInterface/insert",e={url:t,type:"post",resetForm:!0,data:o(),success:function(t){var e=$.parseJSON(t);infoTips(e.message,e.type),$('button[type="reset"]').click()},error:function(t){infoTips(JSON.stringify(t))}};return $(this).ajaxSubmit(e),!1}var l=function(){jQuery().datepicker&&$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"yyyy-mm-dd"})};return $('select[name="oper_ID"]').change(function(){a()||n()}),$('input[name="Reel_Code"]').change(function(){a()||n()}),$('input[name="Reel_Code"]').on("keyup",function(){var t=$(this),e=jsRight(t.val(),1);2==t.val().length&&SetSelect2Val("prod_ID",e)}),$('select[name="prod_ID"]').change(function(){return a()?($('input[name="chk_ID"]').val(""),void $(".grey-cascade").html("")):void n()}),$('button[type="reset"]').on("click",function(){$(".normalPara input").val(""),$("input[name='remark']").val("无"),r(),$("input[name='rec_date']").val(today(6))}),{init:function(){l(),e(),r(),$(".modal-footer .green").on("click",function(){i()}),$('a[name="submit"]').on("click",function(){var t=parseFloat($(".list-unstyled.amounts li:nth(3)").text().replace("当月总分:",""));t>=95?i():bsTips("当月评价总分将低于95分，请检查后重试")}),$(".normalPara input").on("change",function(){var t,e,a=parseFloat($(".list-unstyled.amounts li:nth(2)").text().replace("外观指标:","")),n=parseFloat($(".list-unstyled.amounts li:nth(1)").text().replace("物理指标:","")),r=100,o=$('select[name="prod_ID"]').find("option:selected").text(),i="103-G-7T"===o?[.5,.5,3,3,.75,.75,1,1,.75,.75,.75,.5,.5,.5,.5,3,3,1,3,2,2,.5,.75]:[.5,.5,3,3,.75,.75,1,1,.75,.75,.75,.5,.5,.5,.5,3,3,.5,0,0,0,1,1];$(".normalPara input").map(function(t,a){e=parseInt($(this).attr("name").replace("checkbox",""),10)-1,r-=$(this).val()*i[e]});var l=$('input[name="chk_ID"]').val()-1;if(0===l)a=r;else{var s=a*l;a=(r+s)/(l+1)}t=n+a-100,$(".list-unstyled.amounts li:nth(2)").html("<strong>外观指标:</strong> "+xround(a,2)),$(".list-unstyled.amounts li:nth(0) h4").html("<strong>当前得分:</strong> "+xround(r,2)),$(".list-unstyled.amounts li:nth(3)").html('<h4 class="font-green"><strong>当月总分:</strong> '+xround(t,2)+"</h4>"),t<95?$('a[name="submit"]').attr("href","#info"):$('a[name="submit"]').attr("href","")})}}}();jQuery(document).ready(function(){initDom(),PaperParam.init()}),jQuery(window).resize(function(){HeadFix()});