function GetJsonUrl(e,a,t){var r=getDateRange(),l=getUrlParam("token");null===l&&(l=config.TOKEN);for(var n=getRootPath()+"/DataInterface/Api?Token="+l+"&ID="+e+"&M=3&tstart="+r.start+"&tend="+r.end+"&tstart2="+r.start+"&tend2="+r.end+"&cache="+config.cache,i=location.href.split("&"),o=1;o<i.length;o++){var s=i[o].split("=")[0],c=i[o].split("=")[1];(function(e){var t=!1;return $.each(a,function(a,r){a==e&&(t=!0)}),t})(s)||("-1"==c.indexOf(",")?n+="&"+i[o]:n+="&"+s+"="+c.split(",")[t])}var m=getUrlParam("prod");return null!==m&&(n=n.replace("&prod="+m,""),n+="&prod="+(m=GetSelect2Text("prod_ID"))),n}$("#HideTips").on("click",function(){$(".mt-element-ribbon").addClass("hide")});var isInited=[],mECharts=function(){function e(){require.config({baseUrl:"assets/global/plugins/",paths:{theme:"echarts/theme",echarts:"echarts/js/echarts.min",chartDataTool:"echarts/js/extension/chartDataTool.min",ClipboardJS:"clipboard/clipboard.min",regression:"echarts/js/extension/regression-js/regression.min"}}),require(["echarts","chartDataTool","ClipboardJS","regression"],function(e,t,r,l){var n;x=e,k=t,T=r,void 0===localStorage.eChartsTheme?(n="ali_G2",localStorage.setItem("eChartsTheme","ali_G2")):n=localStorage.eChartsTheme;new T("#share button");require(["theme/"+n],function(e){w=e,a(),z(),d(w)})})}function a(){var e=$(".page-content");for(i=1;i<C;i++){var a='<div class="portlet light bordered" data-chartid = "'+i+'">  <div class="portlet-title">    <div class="page-bar hidden">      <ul class="page-breadcrumb" name="drillName">        <li><i class="icon-home"></i> <a href="javascript:;" data-level="1"></a><i class="fa fa-circle"></i></li>      </ul>    </div>    <button class="btn blue btn-circle" name="downloadExample" data-clipboard-action="copy" data-clipboard-target="#share textarea" data-chartid="'+i+'"><i class="glyphicon glyphicon-download-alt"></i> 下载图表</button>    <a class="btn red btn-circle" name="shareExample" data-chartid="'+i+'"><i class="fa fa-share-alt"></i> 分享 </a>    <div class="actions">      <a class="btn btn-circle btn-icon-only btn-default fullscreen" href="#"></a>    </div>  </div>  <div class="portlet-body form">    <div id="eChart-main'+i+'" optionkey="Line" class="eCharts-main margin-top-5">    </div>  </div></div>';e.append(a)}t()}function t(){var e=getDateRange(),a=getRootPath(0)+"/QualityTable?tid="+getUrlParam("tid")+"&tstart="+e.start+"&tend="+e.end;$('[name="showTable"]').attr({href:a})}function r(e){S[e].on("click",function(a){var t=$(this)[0].chartID;if(L.curLevel[t]>L.maxDrillLevel[t])switch(R.drillType){case"cart":case"paper":window.open(getRootPath()+"/search#"+a.name)}else{S[t].clear();var r={legend:a.seriesName,axis:a.name};R.url=GetJsonUrl(L.id[t].split(";")[L.curLevel[t]-1],R,t),R.url+="&axis="+r.axis+"&legend="+r.legend,"none"!=R.drillChart&&(L.chartType[t]=R.drillChart.split(";"),L.chartType[t].length<L.curLevel[t]?R.type=L.chartType[t][0]:R.type=L.chartType[t][L.curLevel[t]-1]),delete R.data,j[t][L.curLevel[t]]=k.getOption(R,x),S[t].setOption(j[t][L.curLevel[t]]),I[e]=!1,L.nameLength[t]<L.curLevel[t]?(L.nameLength[t]++,L.obj[t].append('<li><a href="javascript:;" data-level="'+(L.curLevel[t]+1)+'">'+a.name+'</a><i class="fa fa-circle"></i></li>')):L.obj[t].find("a:nth("+L.curLevel[t]+")").text(a.name),L.curLevel[t]++}})}function l(e){"none"!=R.drillID&&($(".eCharts-main").parents(".portlet").find(".page-bar").removeClass("hidden"),L.maxDrillLevel[e]=L.id[e].split(";").length,L.obj[e]=$('[name="drillName"]:nth('+e+")"),isInited[e]?L.obj[e].html("<li>"+L.obj[e].find("li").html()+"</li>"):isInited[e]=!0,L.curLevel[e]=1,L.nameLength[e]=0,S[e].chartID=e,r(e),$('[name="drillName"]').on("click","a",function(){var a=$(this).data("level"),t=$(this).parents(".portlet").data("chartid");S[t].clear(),L.curLevel[t]=a,S[t].setOption(j[t][a-1]),I[e]=!1}),L.obj[e].find("a").first().text(j[e][0].title[0].text))}function n(){return{id:getUrlParam("tid").split(","),type:null===getUrlParam("type")?["line"]:getUrlParam("type").split(","),smooth:null===getUrlParam("smooth")?["1"]:getUrlParam("smooth").split(","),blind:null===getUrlParam("blind")?["0"]:getUrlParam("blind").split(","),markLine:null===getUrlParam("markline")?["0"]:getUrlParam("markline").split(","),markLineValue:null===getUrlParam("marklinevalue")?["0"]:getUrlParam("marklinevalue").split(","),markArea:null===getUrlParam("markarea")?["0"]:getUrlParam("markarea").split(","),markAreaValue:null===getUrlParam("markareavalue")?["0"]:getUrlParam("markareavalue").split(","),markPoint:null===getUrlParam("markpoint")?["0"]:getUrlParam("markpoint").split(","),barMaxWidth:null===getUrlParam("barwidth")?["100"]:getUrlParam("barwidth").split(","),splitArea:null===getUrlParam("splitarea")?["0"]:getUrlParam("splitarea").split(","),dataZoom:null===getUrlParam("zoom")?["0"]:getUrlParam("zoom").split(","),minMax:null===getUrlParam("minmax")?["0"]:getUrlParam("minmax").split(","),lineAreaStyle:null===getUrlParam("linearea")?["0"]:getUrlParam("linearea").split(","),lineShadow:null===getUrlParam("lineshadow")?["0"]:getUrlParam("lineshadow").split(","),reverse:null===getUrlParam("reverse")?["0"]:getUrlParam("reverse").split(","),circle:null===getUrlParam("circle")?["0"]:getUrlParam("circle").split(","),roseType:null===getUrlParam("rose")?["0"]:getUrlParam("rose").split(","),dimension:null===getUrlParam("dimension")?["0"]:getUrlParam("dimension").split(","),squareRatio:null===getUrlParam("squareratio")?["1.618"]:getUrlParam("squareratio").split(","),shape:null===getUrlParam("shape")?["polygon"]:getUrlParam("shape").split(","),scatterSize:null===getUrlParam("scattersize")?["20"]:getUrlParam("scattersize").split(","),force:null===getUrlParam("force")?["1"]:getUrlParam("force").split(","),banknoteColor:null===getUrlParam("banknotecolor")?["1"]:getUrlParam("banknotecolor").split(","),stack:null===getUrlParam("stack")?["0"]:getUrlParam("stack").split(","),max:null===getUrlParam("max")?["undefined"]:getUrlParam("max").split(","),min:null===getUrlParam("min")?["undefined"]:getUrlParam("min").split(","),symbolSize:null===getUrlParam("symbolsize")?["12"]:getUrlParam("symbolsize").split(","),opacity:null===getUrlParam("opacity")?["0"]:getUrlParam("opacity").split(","),leafDepth:null===getUrlParam("leafdepth")?["0"]:getUrlParam("leafdepth").split(","),step:null===getUrlParam("step")?["0"]:getUrlParam("step").split(","),singleAxis:null===getUrlParam("singleaxis")?["time"]:getUrlParam("singleaxis").split(","),background:null===getUrlParam("background")?["default"]:getUrlParam("background").split(","),drillID:null===getUrlParam("drill")?["none"]:getUrlParam("drill").split(","),drillType:null===getUrlParam("drilltype")?["none"]:getUrlParam("drilltype").split(","),drillChart:null===getUrlParam("drillchart")?["none"]:getUrlParam("drillchart").split(","),regression:null===getUrlParam("regression")?["none"]:getUrlParam("regression").split(",")}}function o(e,a){return{type:handleParam(e.type,a,"line"),smooth:"1"===handleParam(e.smooth,a,"1"),blind:"0"!==getUrlParam("blind")&&null!==getUrlParam("blind"),toolbox:!0,markLine:handleParam(e.markLine,a,"average"),markLineValue:handleParam(e.markLineValue,a,"0"),markArea:handleParam(e.markArea,a,""),markAreaValue:handleParam(e.markAreaValue,a,"0"),markPoint:"1"===handleParam(e.markPoint,a,"0"),barMaxWidth:handleParam(e.barMaxWidth,a,100),splitArea:"1"===handleParam(e.splitArea,a,"0"),dataZoom:handleParam(e.dataZoom,a,"0"),minMax:"1"===handleParam(e.minMax,a,"0"),lineAreaStyle:"1"===handleParam(e.lineAreaStyle,a,"0"),lineShadow:"1"===handleParam(e.lineShadow,a,"1"),reverse:"1"===handleParam(e.reverse,a,"0"),circle:"1"===handleParam(e.circle,a,"1"),roseType:handleParam(e.roseType,a,"0"),dimension:Number.parseInt(handleParam(e.dimension,a,"1"),10)-1,squareRatio:Number.parseFloat(handleParam(e.squareRatio,a,"1.618")),shape:handleParam(e.shape,a,"polygon"),scatterSize:Number.parseFloat(handleParam(e.scatterSize,a,"20")),force:handleParam(e.force,a,"1"),banknoteColor:handleParam(e.banknoteColor,a,"1"),stack:"1"===handleParam(e.stack,a,"0"),max:handleParam(e.max,a,"1"),min:handleParam(e.min,a,"1"),symbolSize:handleParam(e.symbolSize,a,"12"),opacity:handleParam(e.opacity,a,.4),leafDepth:handleParam(e.leafDepth,a,0),step:handleParam(e.step,a,0),singleAxis:handleParam(e.singleAxis,a,"time"),background:handleParam(e.background,a,"default"),drillID:handleParam(e.drillID,a,"none"),drillType:handleParam(e.drillType,a,"none"),drillChart:handleParam(e.drillChart,a,"none"),regression:handleParam(e.regression,a,"none")}}function s(e){!1!==j[e][0]?(S[e]=x.init(document.getElementById("eChart-main"+e),w),S[e].setOption(j[e][0]),I[e]=!1,l(e)):bsTips("第"+(e+1)+"张图表无数据，请重新选择查询时间",2)}function c(e,a){j[e]=[],(R=o(a,e)).url=GetJsonUrl(a.id[e],R,e),void 0!==w.valueAxis?w.valueAxis.splitArea.show=!!R.splitArea[e]:w.color=["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],R.color=w.color,m(R,e)}function m(e,a){$.ajax({url:e.url}).done(function(t){e.data=$.parseJSON(t),"none"!=e.drillID&&(L.id[a]=e.drillID),e.data.rows&&(j[a][0]=k.getOption(e,x),void 0!==j[a][0].tooltip.axisPointer&&"line"==j[a][0].tooltip.axisPointer.type&&(j[a][0].tooltip.axisPointer.type="cross"),s(a)),++D>C&&(D=1),e.blind&&C==D&&(u(),console.log(a))})}function d(e,a){if(C&&x){var t,r=n();for(t=0;t<C;t++)c(t,r)}}function h(){if($(".actions select opotion").length)return!1;var e,a=$('[name="theme"]'),t="";["default","ali_G2","ali_G2_2","real","real2","real3","powerBI","darkColor","whiteDark","magzin","magzin2","colorful","helianthus","blue","green","red","gray"].map(function(e,a){t+='<option value="'+e+'">'+e+"</option>"}),a.html(t),void 0===localStorage.eChartsTheme?(e="ali_G2",localStorage.setItem("eChartsTheme","ali_G2")):e=localStorage.eChartsTheme,a.find("option").data("icon","fa fa-paint-brush"),$('[name="regression"]').html('<option>回归分析</option><option value="linear">线性回归</option><option value="linearThroughOrigin">过原点的线性回归</option><option value="exponential">指数回归</option><option value="logarithmic">对数回归</option><option value="power">幂回归</option><option value="polynomial">多项式回归</option>'),$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),a.selectpicker("val",e)}function p(e){void 0===e&&(e=$('.bs-select[name="ratio"]').val()),localStorage.setItem("chartRatio",e);var a=$(".portlet-body.form"),t=$(".eCharts-main"),r=a.width()/e;t.css("height",r.toFixed(0))}function u(){for(var e=[],a=0;a<C;a++)e.push(S[a]);x.connect(e)}function g(e){localStorage.setItem("eChartsTheme",e),require(["theme/"+e],function(e){d(w=e)}),S[0].showLoading()}function P(){var e=$('[name="theme"]');e&&$(e).change(function(){g($(this).val())})}function f(){function e(){if("scatter"==getUrlParam("type")){var e=$('[name="regression"]').val();for(i=0;i<C;i++)b(i,e)}else bsTips("回归分析时请将图表类型设为散点图scatter")}if(null==getUrlParam("regression"))return $(".bs-select:nth(0)").selectpicker().hide(),void $(".bs-select:nth(2)").selectpicker().hide();"scatter"==getUrlParam("type")?$('[name="regression"],[name="poly"]').change(function(){e()}):bsTips("回归分析时请将图表类型设为散点图scatter")}function v(e,a){void 0===a&&(a=0);var t=[];return e.map(function(e){t.push([Number.parseFloat(e[a]),Number.parseFloat(e[a+1])])}),t}function b(e,a){var t=j[e][0],r=handleParam(R.regression,e,"none"),l=-1;if(I[e]||1==t.legend.data.length)l=0,r=0;else for(var n=0;n<t.series.length;n++)t.legend.data[r].name==t.series[n].name&&(l=n,n=t.series.length);var i=v(t.series[l].data),o=Number.parseInt($('[name="poly"]').val());1==o&&(o=2);var s=regression(a,i,o),c=t.legend.data[r].name+" 回归曲线",m={data:s.points,name:c,type:"line",symbolSize:8,lineStyle:{normal:{width:2,type:"solid",shadowColor:"rgba(0,0,0,0)",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0}}},d="回归序列:"+t.legend.data[r].name+"\n\n回归函数: "+s.string+"\n\nr^2 : "+s.r2.toFixed(3);if(I[e]){var h=j[e][0].series.length-1;j[e][0].legend.data[h]=c,j[e][0].series[h]=m,j[e][0].title[j[e][0].title.length-1].text=d}else I[e]=!0,j[e][0].legend.data.push(c),j[e][0].series.push(m),j[e][0].title.push({text:d,borderColor:"#999",borderWidth:1,textStyle:{fontSize:14},x2:"1%",y2:"20%"});S[e].clear(),S[e].setOption(j[e][0])}function y(e){var a=0===L.id.length?0:L.curLevel[e]-1,t='<!DOCTYPE html>\n<html style="height: 100%">\n   <head>\n       <meta charset="utf-8">\n   </head>\n   <body style="height: 100%; margin: 0">\n       <div id="container" style="height: 100%"></div>\n       <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/echarts.min.js"><\/script>\n <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/extension/echarts-wordcloud.min.js"><\/script>\n       <script type="text/javascript">\nvar dom = document.getElementById("container");\nvar theme = '+JSON.stringify(w)+";\nvar myChart = echarts.init(dom,theme);\nvar app = {};\noption = null;\noption = "+JSON.stringify(j[e][a]).replace(/null/g,NaN)+'\nif (option && typeof option === "object") {\n    var startTime = +new Date();\n    myChart.setOption(option,true);\n    var endTime = +new Date();\n    var updateTime = endTime - startTime;\n    console.log("Time used:", updateTime);\n}\nwindow.onresize = function(){myChart.resize();};       <\/script>\n   </body>\n</html>',r=new Blob([t],{type:"text/html;charset=UTF-8",encoding:"UTF-8"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=j[e][a].title[0].text+".html",l.click()}function U(e){var a=0===L.id.length?0:L.curLevel[e]-1,t='<!DOCTYPE html>\n<html style="height: 100%">\n   <head>\n       <meta charset="utf-8">\n   </head>\n   <body style="height: 100%; margin: 0">\n       <div id="container" style="height: 100%"></div>\n       <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/echarts.min.js"><\/script>\n <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/extension/echarts-wordcloud.min.js"><\/script>\n      <script type="text/javascript">\nvar dom = document.getElementById("container");\nvar theme = '+JSON.stringify(w)+";\nvar myChart = echarts.init(dom,theme);\nvar app = {};\noption = null;\noption = "+JSON.stringify(j[e][a]).replace(/null/g,NaN)+'\nif (option && typeof option === "object") {\n    var startTime = +new Date();\n    myChart.setOption(option,true);\n    var endTime = +new Date();\n    var updateTime = endTime - startTime;\n    console.log("Time used:", updateTime);\n}\nwindow.onresize = function(){myChart.resize();};       <\/script>\n   </body>\n</html>',r=$.base64.encode((new Date).getTime());$("#share textarea").text(" "),$.ajax({url:getRootPath(0)+"/demo/chartShare.php",type:"POST",async:!1,data:{filename:r+".html",contents:t},success:function(e){try{var a=$.parseJSON(e),t=getRootPath(0)+a.url;$("#share textarea").text(t),$("#successShare").click()}catch(a){console.log(a),infoTips(e),bsTips("图表分享失败，请稍后重试",0)}},error:function(e){console.log(e),bsTips("图表分享失败，请稍后重试",0)}})}var x,k,T,w,S=[],C=null===getUrlParam("tid")?0:getUrlParam("tid").split(",").length,D=0,L={obj:[],curLevel:[],nameLength:[],id:[],maxDrillLevel:[],chartType:[]},j=[],I=[],R={},z=function(){var e=$('.bs-select[name="ratio"]');e.find("option").data("icon","fa fa-down"),void 0===localStorage.chartRatio?(chartRatio=1.78,localStorage.setItem("chartRatio",chartRatio)):chartRatio=localStorage.chartRatio,e.selectpicker("val",chartRatio),p(chartRatio),e&&$(e).change(function(){for(p($(this).val()),i=0;i<C;i++)S[i].resize()})};return $(document).on("click",".ranges li:not(:last),button.applyBtn",function(){var e=$('[name="theme"]');require(["theme/"+e.val()],function(e){w=e,setTimeout(d(w),500)}),t()}),$("#Preview a").on("click",function(){var e=$("#Preview input").val(),a=$('[name="theme"]');require(["theme/"+a.val()],function(a){w=a,setTimeout(d(w,e+"&chartType=line"),500)})}),$(".page-content").on("click",'[name="shareExample"]',function(){U($(this).data("chartid"))}),$(".page-content").on("click",'[name="downloadExample"]',function(){y($(this).data("chartid"))}),{init:function(){h(),e(),P(),f()},resize:function(){for(p(),i=0;i<C;i++)S[i].resize()},option:j,echarts:S}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initProd(),initDom(),mECharts.init(),1==App.getURLParameter("debug")||null===App.getURLParameter("tid")?$("#Preview").show():$("#Preview").hide(),hideSidebarTool(),null!=App.getURLParameter("Token")&&($(".page-title").html('<p style="padding:15px 0;"></p>'),document.title="用户自定义图表")}),jQuery(window).resize(function(){HeadFix(),mECharts.resize()}),$(".fullscreen").on("click",function(){setTimeout(function(){mECharts.resize()},50)});