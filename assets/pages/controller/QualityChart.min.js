function GetJsonUrl(e,a,t){function r(e){var t=!1;return $.each(a,function(a,r){a==e&&(t=!0)}),t}var l=getDateRange(),n=getUrlParam("token");null===n&&(n=config.TOKEN);for(var i=getRootPath()+"/DataInterface/Api?Token="+n+"&ID="+e+"&M=3&tstart="+l.start+"&tend="+l.end+"&tstart2="+l.start+"&tend2="+l.end+"&cache="+config.cache,o=location.href.split("&"),s=1;s<o.length;s++){var m=o[s].split("=")[0],c=o[s].split("=")[1];r(m)||(i+="-1"==c.indexOf(",")?"&"+o[s]:"&"+m+"="+c.split(",")[t])}return i}$("#HideTips").on("click",function(){$(".mt-element-ribbon").addClass("hide")});var isInited=[],mECharts=function(){function e(){require.config({baseUrl:"assets/global/plugins/",paths:{theme:"echarts/theme",echarts:"echarts/js/echarts.min",chartDataTool:"echarts/js/extension/chartDataTool.min",Clipboard:"clipboard/clipboard.min",regression:"echarts/js/extension/regression-js/regression.min"}}),require(["echarts","chartDataTool","Clipboard","regression"],function(e,t,l,n){var i;g=e,f=t,P=l,"undefined"==typeof localStorage.eChartsTheme?(i="ali_G2",localStorage.setItem("eChartsTheme","ali_G2")):i=localStorage.eChartsTheme;(function(){new P("#share button")})();require(["theme/"+i],function(e){v=e,a(),w(),r(v)})})}function a(){var e=$(".page-content");for(i=1;i<y;i++){var a='<div class="portlet light bordered" data-chartid = "'+i+'">  <div class="portlet-title">    <div class="page-bar hidden">      <ul class="page-breadcrumb" name="drillName">        <li><i class="icon-home"></i> <a href="javascript:;" data-level="1"></a><i class="fa fa-circle"></i></li>      </ul>    </div>    <button class="btn blue btn-circle" name="downloadExample" data-clipboard-action="copy" data-clipboard-target="#share textarea" data-chartid="'+i+'"><i class="glyphicon glyphicon-download-alt"></i> 下载图表</button>    <a class="btn red btn-circle" name="shareExample" data-chartid="'+i+'"><i class="fa fa-share-alt"></i> 分享 </a>    <div class="actions">      <a class="btn btn-circle btn-icon-only btn-default fullscreen" href="#"></a>    </div>  </div>  <div class="portlet-body form">    <div id="eChart-main'+i+'" optionkey="Line" class="eCharts-main margin-top-5">    </div>  </div></div>';e.append(a)}t()}function t(){var e=getDateRange(),a=getRootPath(0)+"/QualityTable?tid="+getUrlParam("tid")+"&tstart="+e.start+"&tend="+e.end;$('[name="showTable"]').attr({href:a})}function r(e,a){if(y&&g){var t,r={id:getUrlParam("tid").split(","),type:null===getUrlParam("type")?["line"]:getUrlParam("type").split(","),smooth:null===getUrlParam("smooth")?["1"]:getUrlParam("smooth").split(","),blind:null===getUrlParam("blind")?["0"]:getUrlParam("blind").split(","),markLine:null===getUrlParam("markline")?["0"]:getUrlParam("markline").split(","),markLineValue:null===getUrlParam("marklinevalue")?["0"]:getUrlParam("marklinevalue").split(","),markArea:null===getUrlParam("markarea")?["0"]:getUrlParam("markarea").split(","),markAreaValue:null===getUrlParam("markareavalue")?["0"]:getUrlParam("markareavalue").split(","),markPoint:null===getUrlParam("markpoint")?["0"]:getUrlParam("markpoint").split(","),barMaxWidth:null===getUrlParam("barwidth")?["100"]:getUrlParam("barwidth").split(","),splitArea:null===getUrlParam("splitarea")?["0"]:getUrlParam("splitarea").split(","),dataZoom:null===getUrlParam("zoom")?["0"]:getUrlParam("zoom").split(","),minMax:null===getUrlParam("minmax")?["0"]:getUrlParam("minmax").split(","),lineAreaStyle:null===getUrlParam("linearea")?["0"]:getUrlParam("linearea").split(","),lineShadow:null===getUrlParam("lineshadow")?["0"]:getUrlParam("lineshadow").split(","),reverse:null===getUrlParam("reverse")?["0"]:getUrlParam("reverse").split(","),circle:null===getUrlParam("circle")?["0"]:getUrlParam("circle").split(","),roseType:null===getUrlParam("rose")?["0"]:getUrlParam("rose").split(","),dimension:null===getUrlParam("dimension")?["0"]:getUrlParam("dimension").split(","),squareRatio:null===getUrlParam("squareratio")?["1.618"]:getUrlParam("squareratio").split(","),shape:null===getUrlParam("shape")?["polygon"]:getUrlParam("shape").split(","),scatterSize:null===getUrlParam("scattersize")?["20"]:getUrlParam("scattersize").split(","),force:null===getUrlParam("force")?["1"]:getUrlParam("force").split(","),banknoteColor:null===getUrlParam("banknotecolor")?["1"]:getUrlParam("banknotecolor").split(","),stack:null===getUrlParam("stack")?["0"]:getUrlParam("stack").split(","),max:null===getUrlParam("max")?["undefined"]:getUrlParam("max").split(","),min:null===getUrlParam("min")?["undefined"]:getUrlParam("min").split(","),symbolSize:null===getUrlParam("symbolsize")?["12"]:getUrlParam("symbolsize").split(","),opacity:null===getUrlParam("opacity")?["0"]:getUrlParam("opacity").split(","),leafDepth:null===getUrlParam("leafdepth")?["0"]:getUrlParam("leafdepth").split(","),step:null===getUrlParam("step")?["0"]:getUrlParam("step").split(","),singleAxis:null===getUrlParam("singleaxis")?["time"]:getUrlParam("singleaxis").split(","),background:null===getUrlParam("background")?["default"]:getUrlParam("background").split(","),drillID:null===getUrlParam("drill")?["none"]:getUrlParam("drill").split(","),drillType:null===getUrlParam("drilltype")?["none"]:getUrlParam("drilltype").split(","),drillChart:null===getUrlParam("drillchart")?["none"]:getUrlParam("drillchart").split(","),regression:null===getUrlParam("regression")?["none"]:getUrlParam("regression").split(",")};for(t=0;y>t;t++)x={type:handleParam(r.type,t,"line"),smooth:"1"===handleParam(r.smooth,t,"1"),blind:"0"!==getUrlParam("blind")&&null!==getUrlParam("blind"),toolbox:!0,markLine:handleParam(r.markLine,t,"average"),markLineValue:handleParam(r.markLineValue,t,"0"),markArea:handleParam(r.markArea,t,""),markAreaValue:handleParam(r.markAreaValue,t,"0"),markPoint:"1"===handleParam(r.markPoint,t,"0"),barMaxWidth:handleParam(r.barMaxWidth,t,100),splitArea:"1"===handleParam(r.splitArea,t,"0"),dataZoom:handleParam(r.dataZoom,t,"0"),minMax:"1"===handleParam(r.minMax,t,"0"),lineAreaStyle:"1"===handleParam(r.lineAreaStyle,t,"0"),lineShadow:"1"===handleParam(r.lineShadow,t,"1"),reverse:"1"===handleParam(r.reverse,t,"0"),circle:"1"===handleParam(r.circle,t,"1"),roseType:handleParam(r.roseType,t,"0"),dimension:Number.parseInt(handleParam(r.dimension,t,"1"),10)-1,squareRatio:Number.parseFloat(handleParam(r.squareRatio,t,"1.618")),shape:handleParam(r.shape,t,"polygon"),scatterSize:Number.parseFloat(handleParam(r.scatterSize,t,"20")),force:handleParam(r.force,t,"1"),banknoteColor:handleParam(r.banknoteColor,t,"1"),stack:"1"===handleParam(r.stack,t,"0"),max:handleParam(r.max,t,"1"),min:handleParam(r.min,t,"1"),symbolSize:handleParam(r.symbolSize,t,"12"),opacity:handleParam(r.opacity,t,.4),leafDepth:handleParam(r.leafDepth,t,0),step:handleParam(r.step,t,0),singleAxis:handleParam(r.singleAxis,t,"time"),background:handleParam(r.background,t,"default"),drillID:handleParam(r.drillID,t,"none"),drillType:handleParam(r.drillType,t,"none"),drillChart:handleParam(r.drillChart,t,"none"),regression:handleParam(r.regression,t,"none")},x.url=GetJsonUrl(r.id[t],x,t),"undefined"!=typeof e.valueAxis?e.valueAxis.splitArea.show=!!x.splitArea[t]:e.color=["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],x.color=e.color,k[t]=[],k[t][0]=f.getOption(x,g),k[t][0]!==!1?(b[t]=g.init(document.getElementById("eChart-main"+t),e),b[t].setOption(k[t][0]),T[t]=!1,"none"!=x.drillID&&($(".eCharts-main").parents(".portlet").find(".page-bar").removeClass("hidden"),U.id[t]=x.drillID.split(";"),U.maxDrillLevel[t]=U.id[t].length,U.obj[t]=$('[name="drillName"]:nth('+t+")"),isInited[t]?U.obj[t].html("<li>"+U.obj[t].find("li").html()+"</li>"):isInited[t]=!0,U.curLevel[t]=1,U.nameLength[t]=0,b[t].chartID=t,b[t].on("click",function(e){var a=$(this)[0].chartID;if(U.curLevel[a]>U.maxDrillLevel[a])switch(x.drillType){case"cart":infoTips("查询车号:"+e.name);break;case"paper":infoTips("查询轴号:"+e.name)}else{b[a].clear();var r={legend:e.seriesName,axis:e.name};x.url=GetJsonUrl(U.id[a][U.curLevel[a]-1],x,a),x.url+="&axis="+r.axis+"&legend="+r.legend,"none"!=x.drillChart&&(U.chartType[a]=x.drillChart.split(";"),U.chartType[a].length<U.curLevel[a]?x.type=U.chartType[a][0]:x.type=U.chartType[a][U.curLevel[a]-1]),k[a][U.curLevel[a]]=f.getOption(x,g),b[a].setOption(k[a][U.curLevel[a]]),T[t]=!1,U.nameLength[a]<U.curLevel[a]?(U.nameLength[a]++,U.obj[a].append('<li><a href="javascript:;" data-level="'+(U.curLevel[a]+1)+'">'+e.name+'</a><i class="fa fa-circle"></i></li>')):U.obj[a].find("a:nth("+U.curLevel[a]+")").text(e.name),U.curLevel[a]++}}),$('[name="drillName"]').on("click","a",function(){var e=$(this).data("level"),a=$(this).parents(".portlet").data("chartid");b[a].clear(),U.curLevel[a]=e,b[a].setOption(k[a][e-1]),T[t]=!1}),U.obj[t].find("a").first().text(k[t][0].title[0].text))):bsTips("第"+(t+1)+"张图表无数据，请重新选择查询时间",2);x.blind&&o()}}function l(){if($(".actions select opotion").length)return!1;var e,a=$('[name="theme"]'),t="",r=["default","ali_G2","ali_G2_2","real","real2","real3","powerBI","darkColor","whiteDark","magzin","magzin2","colorful","helianthus","blue","green","red","gray"];r.map(function(e,a){t+='<option value="'+e+'">'+e+"</option>"}),a.html(t),"undefined"==typeof localStorage.eChartsTheme?(e="ali_G2",localStorage.setItem("eChartsTheme","ali_G2")):e=localStorage.eChartsTheme,a.find("option").data("icon","fa fa-paint-brush"),$('[name="regression"]').html('<option>回归分析</option><option value="linear">线性回归</option><option value="linearThroughOrigin">过原点的线性回归</option><option value="exponential">指数回归</option><option value="logarithmic">对数回归</option><option value="power">幂回归</option><option value="polynomial">多项式回归</option>'),$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),a.selectpicker("val",e)}function n(e){"undefined"==typeof e&&(e=$('.bs-select[name="ratio"]').val()),localStorage.setItem("chartRatio",e);var a=$(".portlet-body.form"),t=$(".eCharts-main"),r=a.width(),l=r/e;t.css("height",l.toFixed(0))}function o(){for(var e=[],a=0;y>a;a++)e.push(b[a]);g.connect(e)}function s(e){localStorage.setItem("eChartsTheme",e),require(["theme/"+e],function(e){v=e,r(v)}),b[0].showLoading()}function m(){var e=$('[name="theme"]');e&&$(e).change(function(){s($(this).val())})}function c(){function e(){if("scatter"!=getUrlParam("type"))return void bsTips("回归分析时请将图表类型设为散点图scatter");var e=$('[name="regression"]').val();for(i=0;i<y;i++)h(i,e)}return null==getUrlParam("regression")?($(".bs-select:nth(0)").selectpicker().hide(),void $(".bs-select:nth(2)").selectpicker().hide()):"scatter"!=getUrlParam("type")?void bsTips("回归分析时请将图表类型设为散点图scatter"):void $('[name="regression"],[name="poly"]').change(function(){e()})}function d(e,a){"undefined"==typeof a&&(a=0);var t=[];return e.map(function(e){t.push([Number.parseFloat(e[a]),Number.parseFloat(e[a+1])])}),t}function h(e,a){var t=k[e][0],r=handleParam(x.regression,e,"none"),l=-1;if(T[e]||1==t.legend.data.length)l=0,r=0;else for(var n=0;n<t.series.length;n++)t.legend.data[r].name==t.series[n].name&&(l=n,n=t.series.length);var i=d(t.series[l].data),o=Number.parseInt($('[name="poly"]').val());1==o&&(o=2);var s=regression(a,i,o),m=t.legend.data[r].name+" 回归曲线",c={data:s.points,name:m,type:"line",symbolSize:8,lineStyle:{normal:{width:2,type:"solid",shadowColor:"rgba(0,0,0,0)",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0}}},h="回归序列:"+t.legend.data[r].name+"\n\n回归函数: "+s.string+"\n\nr^2 : "+s.r2.toFixed(3);if(T[e]){var p=k[e][0].series.length-1;k[e][0].legend.data[p]=m,k[e][0].series[p]=c,k[e][0].title[k[e][0].title.length-1].text=h}else T[e]=!0,k[e][0].legend.data.push(m),k[e][0].series.push(c),k[e][0].title.push({text:h,borderColor:"#999",borderWidth:1,textStyle:{fontSize:14},x2:"1%",y2:"20%"});b[e].clear(),b[e].setOption(k[e][0])}function p(e){var a=0===U.id.length?0:U.curLevel[e]-1,t='<!DOCTYPE html>\n<html style="height: 100%">\n   <head>\n       <meta charset="utf-8">\n   </head>\n   <body style="height: 100%; margin: 0">\n       <div id="container" style="height: 100%"></div>\n       <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/echarts.min.js"></script>\n <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/extension/echarts-wordcloud.min.js"></script>\n       <script type="text/javascript">\nvar dom = document.getElementById("container");\nvar theme = '+JSON.stringify(v)+";\nvar myChart = echarts.init(dom,theme);\nvar app = {};\noption = null;\noption = "+JSON.stringify(k[e][a]).replace(/null/g,NaN)+'\nif (option && typeof option === "object") {\n    var startTime = +new Date();\n    myChart.setOption(option,true);\n    var endTime = +new Date();\n    var updateTime = endTime - startTime;\n    console.log("Time used:", updateTime);\n}\nwindow.onresize = function(){myChart.resize();};       </script>\n   </body>\n</html>',r=new Blob([t],{type:"text/html;charset=UTF-8",encoding:"UTF-8"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=k[e][a].title[0].text+".html",l.click()}function u(e){var a=0===U.id.length?0:U.curLevel[e]-1,t='<!DOCTYPE html>\n<html style="height: 100%">\n   <head>\n       <meta charset="utf-8">\n   </head>\n   <body style="height: 100%; margin: 0">\n       <div id="container" style="height: 100%"></div>\n       <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/echarts.min.js"></script>\n <script type="text/javascript" src="'+getRootPath(1)+'/assets/global/plugins/echarts/js/extension/echarts-wordcloud.min.js"></script>\n      <script type="text/javascript">\nvar dom = document.getElementById("container");\nvar theme = '+JSON.stringify(v)+";\nvar myChart = echarts.init(dom,theme);\nvar app = {};\noption = null;\noption = "+JSON.stringify(k[e][a]).replace(/null/g,NaN)+'\nif (option && typeof option === "object") {\n    var startTime = +new Date();\n    myChart.setOption(option,true);\n    var endTime = +new Date();\n    var updateTime = endTime - startTime;\n    console.log("Time used:", updateTime);\n}\nwindow.onresize = function(){myChart.resize();};       </script>\n   </body>\n</html>',r=$.base64.encode((new Date).getTime());$("#share textarea").text(" "),$.ajax({url:getRootPath(0)+"/demo/chartShare.php",type:"POST",async:!1,data:{filename:r+".html",contents:t},success:function(e){try{var a=$.parseJSON(e),t=getRootPath(0)+a.url;$("#share textarea").text(t),$("#successShare").click()}catch(r){console.log(r),infoTips(e),bsTips("图表分享失败，请稍后重试",0)}},error:function(e){console.log(e),bsTips("图表分享失败，请稍后重试",0)}})}var g,f,P,v,b=[],y=null===getUrlParam("tid")?0:getUrlParam("tid").split(",").length,U={obj:[],curLevel:[],nameLength:[],id:[],maxDrillLevel:[],chartType:[]},k=[],T=[],x={},w=function(){var e=$('.bs-select[name="ratio"]');e.find("option").data("icon","fa fa-down"),"undefined"==typeof localStorage.chartRatio?(chartRatio=1.78,localStorage.setItem("chartRatio",chartRatio)):chartRatio=localStorage.chartRatio,e.selectpicker("val",chartRatio),n(chartRatio),e&&$(e).change(function(){for(n($(this).val()),i=0;i<y;i++)b[i].resize()})};return $(document).on("click",".ranges li:not(:last),button.applyBtn",function(){var e=$('[name="theme"]');require(["theme/"+e.val()],function(e){v=e,setTimeout(r(v),500)}),t()}),$("#Preview a").on("click",function(){var e=$("#Preview input").val(),a=$('[name="theme"]');require(["theme/"+a.val()],function(a){v=a,setTimeout(r(v,e+"&chartType=line"),500)})}),$(".page-content").on("click",'[name="shareExample"]',function(){u($(this).data("chartid"))}),$(".page-content").on("click",'[name="downloadExample"]',function(){p($(this).data("chartid"))}),{init:function(){l(),e(),m(),c()},resize:function(){for(n(),i=0;i<y;i++)b[i].resize()},option:k,echarts:b}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(),mECharts.init(),1==App.getURLParameter("debug")||null===App.getURLParameter("tid")?$("#Preview").show():$("#Preview").hide(),hideSidebarTool()}),jQuery(window).resize(function(){HeadFix(),mECharts.resize()}),$(".fullscreen").on("click",function(){setTimeout(function(){mECharts.resize()},50)});