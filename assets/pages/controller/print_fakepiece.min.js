var FakePiece=function(){function e(){function e(e,t){var a="<tr>\t<td>"+t+"</td>";return e.map(function(e){a+="\t<td>"+e+"</td>"}),a+="</tr>"}var t=$('[name="fakeList"] tbody'),a=$("input[name='rec_date']").val();a=a.replace(/-/g,"");var n=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=246&M=3&tstart="+a;$.ajax({url:n}).done(function(a){if(0!==(a=handleAjaxData(a)).rows){var n="";a.data.map(function(t,a){n+=e(t,a+1)}),t.html(n)}else t.html('<tr><td class="text-center" colspan='+(a.cols+1)+">指定时间内无数据</td></tr>")})}function t(){var e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=35&M=3&t=1&cache=14400";$.ajax({url:e}).done(function(e){var t=handleAjaxData(e);InitSelect("prod_ID",t)}),e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=245&M=3&cache=14400",$.ajax({url:e}).done(function(e){var t=handleAjaxData(e);InitSelect("ProcID",t)}),e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=495&M=3&cache=14400",$.ajax({url:e}).done(function(e){var t=handleAjaxData(e);InitSelect("KiloID",t)}),initSelect2()}function a(){$("input[name='rec_date']").val(today(6)),e(),t(),$("input[name='remark']").val("无"),$(".page-header .dropdown-quick-sidebar-toggler").hide(),c()}function n(){var e={tbl:TBL.PRINT_FAKEPIECE,CartNumber:$("input[name='cart_number']").val().trim().toUpperCase(),ProductType:GetSelect2Text("prod_ID"),ProcID:$('select[name="ProcID"]').val(),KiloID:$('select[name="KiloID"]').val(),Date:$("input[name='rec_date']").val().replace(/-/g,""),Describe:$("input[name='remark']").val(),utf2gbk:["Describe"]},t=["FakePiece","HalfPiece","NoNum"],a=JSON.stringify(e);a=a.replace("}","");var n;return $(".fakeNum input").map(function(e){""===(n=$(this).val())&&(n=0),a=a+',"'+t[e]+'":'+n}),a+="}",console.log(a),$.parseJSON(a)}function r(){SetSelect2Val("ProcID",-1),$(".fakeNum input").val("0"),$("[name='remark']").val("无"),$("[name='cart_number']").focus()}function i(){var t={url:getRootPath()+"/DataInterface/insert",type:"post",resetForm:!0,data:n(),success:function(t){var a=$.parseJSON(t);bsTips(a.message,a.type),r(),e()},error:function(e){infoTips(JSON.stringify(e))}};return $.ajax(t),!1}var o=function(){jQuery().datepicker&&$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"yyyy-mm-dd"})},c=function(){$("input[name='cart_number']").maxlength({limitReachedClass:"label label-danger",threshold:3}),extendValidateRule();var e=getValidateRule("theForm");e.cart_number={minlength:8,maxlength:8,isCartNumber:!0,required:!0},e.rec_date.number=!1,e.FakePiece={digits:!0,required:!1},e.HalfPiece=e.FakePiece,e.NoNum=e.FakePiece,$("form[name=theForm]").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:e,messages:{cart_number:{required:"车号不能为空."}},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},submitHandler:function(e){i()}})};return $('input[name="cart_number"]').on("keyup",function(){var e=$(this).val();if(e.length>=3){var t=e.substr(2,1);SetSelect2Val("prod_ID",t)}}),$('[name="reset"]').on("click",function(){r()}),{init:function(){o(),a()}}}();jQuery(document).ready(function(){initDom(),FakePiece.init()}),jQuery(window).resize(function(){HeadFix()});