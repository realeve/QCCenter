var Index=function(){function t(t,e,a,i){$('<div id="tooltip" class="chart-tooltip">'+i+"</div>").css({position:"absolute",display:"none",top:e-40,left:t-40,border:"0px solid #ccc",padding:"2px 6px","background-color":"#fff",background:"#fff"}).appendTo("body").fadeIn(200)}function e(e,a,i,o,n){if(o=o||0,$("#x").text(e.x.toFixed(o)),$("#y").text(e.y.toFixed(o)),a){if(l!=a.dataIndex){l=a.dataIndex,previousSeries=a.seriesIndex-1,$("#tooltip").remove();var r,s=(a.datapoint[0].toFixed(o),a.datapoint[1].toFixed(o),a.series.data[a.datapoint[0]][0]),c=0;"undefined"==typeof n?r=s+" : "+a.datapoint[1].toFixed(o)+" "+i:(r='<span class="caption-subject">'+s+"</span><br>"+n[previousSeries].label.trim()+" : "+a.datapoint[1].toFixed(0)+" "+i,c=22),t(a.pageX+10,a.pageY-c,a.datapoint[0],r)}}else $("#tooltip").remove(),l=null}var a=function(){$(".theme-panel").hide(),hideSidebarTool()},i=function(t,e){$().counterUp&&t.counterUp({delay:10,time:e})},o=(function(){var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=168&M=3",e=ReadData(t);e.data[0].map(function(t,e){$(".dashboard-stat .number:nth("+e+")").attr("data-value",data2ThousandSeparator(t)).text(data2ThousandSeparator(t))}),e.data[0][4]&&bsTips("近期有机检异常产品，请注意!"),i($(".top-info .number"),800)}(),function(){function t(t){var a=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID="+t+"&M=3&cache="+config.cache,i=ReadData(a),o="";return i.data.map(function(t){var a=t[0];o+='\n<div class="col-md-2 col-sm-2 col-xs-6"><div class="'+e[a]+' font-sm">'+a+"</div>",o+='			<div class="uppercase font-hg '+e[a]+'"><span class="number" data-counter="counterup" data-value='+t[1]+">"+t[1],o+='</span><span class="font-lg font-grey-mint">%</span>',o+="			</div></div>"}),0===i.rows&&(o='<h3 style="padding-left:20px;height:20px;">对应时间无质量信息</h3>'),o}var e={"9602A":"font-green-jungle","103-G-2A":"font-green-jungle","9603A":"font-purple","103-G-3A":"font-purple","9604A":"font-blue","103-G-4A":"font-blue","9606A":"font-green-seagreen","103-G-6A":"font-green-seagreen","9607T":"font-red-flamingo","103-G-7T":"font-red-flamingo"};$('[name="hisQuality"] label').on("click",function(){$('[name="hisQuality"] .list-separated').html(a[$(this).data("id")]),i($('[name="hisQuality"] .number'),300)});for(var a=[],o=0;3>o;o++)a[o]=t(o+169);(function(){$('[name="hisQuality"] .list-separated').html(a[0]),i($('[name="hisQuality"] .number'),300)})(),function(){var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=172&M=0&cache="+config.cache,e=ReadData(t),a={element:"passed_a_year_quality_static",padding:0,behaveLikeLine:!1,gridEnabled:!1,gridLineColor:!1,axes:!1,fillOpacity:1,ymin:70,data:e.data,lineColors:["#399a8c"],xkey:e.header[0].title,ykeys:[e.header[1].title],labels:[e.header[1].title],pointSize:0,lineWidth:0,hideHover:"auto",resize:!0};Morris.EventEmitter&&e.rows>0&&(s=Morris.Area(a))}()}),n=function(){return{initDashboardWidget:function(){$('.task-list input[type="checkbox"]').change(function(){$(this).is(":checked")?$(this).parents("li").addClass("task-done"):$(this).parents("li").removeClass("task-done")}),$(".task-list").on("click",".complete,.task-checkbox,.liChild,.task-title",function(){var t=$(this).parent().find(".liChild"),e=$(this).parents("li");t.val();t.parent().hasClass("checked")?(e.removeClass("task-done"),t.parent().removeClass("checked"),bsTips("任务标记为未完成，请在后台更新数据",2)):(e.addClass("task-done"),t.parent().addClass("checked"),bsTips("任务标记为已完成，请在后台更新数据",2))}),$(".task-list").on("click",".del",function(){$(this).parents("li").remove();bsTips("任务成功删除，请在后台更新数据",2)})}}}(),l=null,r=function(){var t,a=function(){var e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=173&M=3&cache=1440",a=ReadData(e);t={hardDisk:[],sqlSvr:[],data_uploads:[],realQuality:[]},a.data.map(function(e){t.hardDisk.push([e[0],e[2]]),t.sqlSvr.push([e[0],Number.parseFloat(e[3].replace("MB",""))/1e3]),t.data_uploads.push([e[0],e[4]]),5!=e[5]&&t.realQuality.push([e[0],e[1]])})};(function(){function i(){return a(),t.realQuality}function o(t,e){e=e||0;var a=e?"#f89f9f":"#893a7c";return[{data:t,lines:{fill:.9,lineWidth:0},color:[a]},{data:t,yaxis:1,points:{show:!0,fill:!0,radius:5,fillColor:a,lineWidth:3},color:"#fff",shadowSize:0}]}$("#real_quality_loading").hide(),$("#real_quality_content").show();var n,l=0,r=i(),s=function(t){var e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=174&M=3&machine="+t+"&cache="+config.cache,a=ReadData(e);return o(a.data,1)},c={xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"},show:!1},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",max:100,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1},legend:{show:!1}};$("#real_quality_statistics").bind("plothover",function(t,a,i){e(a,i,"%",2)}),$("#real_quality_statistics").bind("plotclick",function(t,e,a){var i;l?(i=n[0].data[a.dataIndex][0],bsTips("车号追溯功能加入后跳转至"+i+"详细信息",2)):(i=r[a.dataIndex][0],$('[name="curQuality_title"]').text(i),n=s(i),$.plot($("#real_quality_statistics"),n,c),l++)}),$('[name="curQuality"]').on("click",function(){$.plot($("#real_quality_statistics"),o(r),c),$('[name="curQuality_title"]').text("实时质量"),l=0}),$('[name="curQuality"]').click()})(),function(){function a(t,e){return[{data:e,yaxis:1,lines:{fill:.6,lineWidth:0},color:["#f89f9f"],label:"&nbsp;数据库大小&nbsp;"},{data:e,yaxis:1,points:{show:!0,fill:!0,radius:5,fillColor:"#f89f9f",lineWidth:3},color:"#fff",shadowSize:0},{data:t,yaxis:2,lines:{fill:.6,lineWidth:0},color:["#92e9dc"],label:"&nbsp;硬盘可用量&nbsp;"},{data:t,yaxis:2,points:{show:!0,fill:!0,radius:5,fillColor:"#92e9dc",lineWidth:3},color:"#fff",shadowSize:0}]}function i(t){return[{data:t,lines:{fill:.3,lineWidth:0},color:["#BAD9F5"]},{data:t,points:{show:!0,fill:!0,radius:4,fillColor:"#9ACAE6",lineWidth:2},color:"#9ACAE6",shadowSize:1,label:"数据上传"},{data:t,lines:{show:!0,fill:!1,lineWidth:3},color:"#9ACAE6",shadowSize:0}]}if(jQuery.plot){var o=a(t.hardDisk,t.sqlSvr),n=i(t.data_uploads);if(0!==$("#site_statistics").size()){$("#site_statistics_loading").hide(),$("#site_statistics_content").show();$.plot($("#site_statistics"),o,{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"},show:!1},yaxes:[{ticks:5,tickDecimals:0,tickColor:"#eee",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},{ticks:5,tickDecimals:0,tickColor:"#eee",position:"right",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}}],grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1},legend:{show:!0,noColumns:!1,container:"#site_statistics_legend"}});$("#site_statistics").bind("plothover",function(t,a,i){e(a,i,"GB",0,o)})}if(0!==$("#data_upload").size()){$("#data_upload_loading").hide(),$("#data_upload_content").show();$.plot($("#data_upload"),n,{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:18,style:"normal",variant:"small-caps",color:"#6F7B8A"},show:!1},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"},max:20},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1},legend:{show:!1,noColumns:!1,container:"#data_upload_legend"}});$("#data_upload").bind("plothover",function(t,a,i){e(a,i,"车")}),$("#data_upload").bind("mouseleave",function(){$("#tooltip").remove()})}}}()},s=null;redrawCharts=function(){s.resizeHandler()},initMiniCharts=function(){App.isIE8()&&!Function.prototype.bind&&(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),a=this,i=function(){},o=function(){return a.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),$("#sparkline_bar").sparkline([8,9,10,11,10,10,12,10,10,11,9,12,11],{type:"bar",width:"100",barWidth:6,height:"45",barColor:"#F36A5B",negBarColor:"#e02222"}),$("#sparkline_bar2").sparkline([9,11,12,13,12,13,10,14,13,11,11,12,11],{type:"bar",width:"100",barWidth:6,height:"45",barColor:"#5C9BD1",negBarColor:"#e02222"})};var c=function(){var t=function(){var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=175&M=0&cache="+config.cache,e=ReadData(t),a={element:"noteAnany_static",behaveLikeLine:!1,fillOpacity:1,stacked:0,ymin:95,ymax:100,data:e.data,xkey:e.header[0].title,ykeys:[e.header[1].title,e.header[2].title,e.header[3].title],labels:[e.header[1].title,e.header[2].title,e.header[3].title],hideHover:!0,resize:!0};Morris.EventEmitter&&e.rows>0&&(s=Morris.Bar(a))},a=!1,i=function(){var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=176&M=3",a=ReadData(t),i=[];a.data.map(function(t){i.push([t[0],t[3]])});$.plot($("#statistics_2"),[{data:i,lines:{fill:.9,lineWidth:0},color:["#556"],label:"过程质量评分"},{data:i,yaxis:1,points:{show:!0,fill:!0,radius:5,fillColor:"#556",lineWidth:3},color:"#fff",shadowSize:0}],{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:2,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:4,tickDecimals:0,tickColor:"#f0f0f0",min:96,max:100,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{backgroundColor:{colors:["#fff","#fff"]},borderWidth:1,borderColor:"#f0f0f0",margin:0,minBorderMargin:0,labelMargin:20,hoverable:!0,clickable:!0,mouseActiveRadius:6},legend:{show:!0}});$("#statistics_2").bind("plothover",function(t,a,i){e(a,i,"分",2)})};return{init:function(){t(),$("#process_quality_cut_tab").on("shown.bs.tab",function(t){a||(i(),a=!0)}),$("#process_quality_offline_tab").on("shown.bs.tab",function(t){bsTips("即将添加")})}}}();return{init:function(){a(),o(),r(),c.init(),n.initDashboardWidget(),initMiniCharts()}}}(),mECharts=function(){function t(){require.config({baseUrl:"assets/global/plugins/",paths:{theme:"echarts/theme",echarts:"echarts/js/echarts.min",chartDataTool:"echarts/js/extension/chartDataTool.min"}}),require(["echarts","chartDataTool"],function(t,n){var l;a=t,i=n,"undefined"==typeof localStorage.eChartsTheme?(l="ali_G2",localStorage.setItem("eChartsTheme","ali_G2")):l=localStorage.eChartsTheme,require(["theme/"+l],function(t){o=t,e(o)})})}function e(t){function e(){var t=new Date,e=t.getFullYear(),a=jsRight("0"+(t.getMonth()+1),2),i=jsRight("0"+t.getDate(),2);return e+a+i}function o(){var t=new Date,e=t.getFullYear()-1,a=jsRight("0"+(t.getMonth()+1),2),i=jsRight("0"+t.getDate(),2);return e+a+i}if(a){var s={start:jsLeft(e(),6)+"01",end:jsLeft(e(),6)+"31"},c={start:jsLeft(o(),6)+"01",end:jsLeft(o(),6)+"31"};r=0;var d={url:getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&ID=222&M=3&tstart="+s.start+"&tend="+s.end+"&tstart2="+c.start+"&tend2="+c.end+"&cache="+config.cache,type:"bar"};for("undefined"!=typeof t.color&&(d.color=t.color),l[r]=i.getOption(d,a),l[r]!==!1&&(delete l[r].title,delete l[r].toolbox,delete l[r].dataZoom,l[r].grid.bottom="3%",l[r].legend.y=0,delete l[r].xAxis[0].name),r=1,d={url:getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&ID=181&M=3&tstart="+s.start+"&tend="+s.end+"&tstart2="+s.start+"&tend2="+s.end+"&cache="+config.cache,singleAxis:"time",type:"themeriver"},"undefined"!=typeof t.color&&(d.color=t.color),l[r]=i.getOption(d,a),"undefined"!=typeof l[r].series&&(delete l[r].toolbox,l[r].title[2].x="center",l[r].title[2].y=40,l[r].title[2].y2=0,l[r].title[1].show=!1,l[r].title[3].show=!1,l[r].legend.orient="horizontal"),r=0;2>r;r++)l[r]!==!1&&(n[r]=a.init(document.getElementById("nocheck_statistics_"+r),t),n[r].setOption(l[r]),$("#nocheck_loading_"+r).addClass("display-none"),$("#nocheck_content_"+r).removeClass("display-none"))}}var a,i,o,n=[],l=[],r=0;return{resize:function(){n[0].resize(),n[1].resize()},init:function(){t()}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDom(),Index.init(),mECharts.init()}),jQuery(window).resize(function(){HeadFix(),mECharts.resize()});