function GetJsonUrl(e){var t=getDateRange(),a="";window.location.href.split("?")[1].split("&").map(function(e,t){"tid="!==jsLeft(e,4)&&(a+="&"+e)}),a=a.split("#")[0];var n=getUrlParam("token");null===n&&(n=config.TOKEN);var l=getRootPath()+"/DataInterface/Api?Token="+n+"&ID="+e+"&M=3&tstart="+t.start+"&tend="+t.end+"&tstart2="+t.start+"&tend2="+t.end+"&tstart3="+t.start+"&tend3="+t.end+"&tstart4="+t.start+"&tend4="+t.end+a+"&cache="+config.cache;if(location.hash.indexOf("cart")>-1){var r=location.hash.replace("#cart=","");l+="&cart="+r.toUpperCase()+"&cart2="+r.toUpperCase()+"&cart3="+r.toUpperCase()}var i=getUrlParam("prod");null!==i&&(l=l.replace("&prod="+i,""),l+="&prod="+(i=GetSelect2Text("prod_ID")));var o=getUrlParam("multi");if(null!==o){var s=$("#multi input").val().trim().replace(/，/g,",").toUpperCase();","==jsRight(s,1)&&(s=s.substring(0,s.length-1)),-1!=s.indexOf(" ")&&-1==s.indexOf(",")&&(s=(s=(s=s.split(" ")).filter(function(e){return e.length>0})).join(",")),l+="&"+o+"="+(s=s.replace(/,/g,"','"))}return l}$("#HideTips").on("click",function(){$(this).parent().hide()});var loadPDF=getUrlParam("pdf"),dataTable=function(){function e(e){if(1==App.getURLParameter("debug")||null===App.getURLParameter("tid"))$("#Preview").show(),s('[name="sampleTable"]',$("#Preview input").val());else{var t,a={id:getUrlParam("tid").split(","),fixheader:null===getUrlParam("fixheader")?["1"]:getUrlParam("fixheader").split(",")},n=a.id.length;if(n>1&&e){var l=$('[name="sampleTable"]').parents(".portlet:nth(0)");for(t=0;t<n-1;t++)l.parent().append(l.clone())}for(config.info.qualitytable=!1,t=0;t<n;t++)objRequest={url:GetJsonUrl(a.id[t]),fixheader:"1"==handleParam(a.fixheader,t,"1")},"0"==objRequest.fixheader&&$('[name="sampleTable"]:eq('+t+")").removeClass("table-header-fixed").addClass("dt-responsive"),s('[name="sampleTable"]:eq('+t+")",objRequest.url,objRequest.fixheader)}}function t(e,t){var a=e.api(),n=e.fnSettings(),l=a.row(0).data(),r=p[n.sInstance.replace("DataTables_Table_","")],i=$.parseJSON(localStorage.getItem("DataTables/qualitytable/"+r));a.columns().indexes().flatten().each(function(e){var n=a.column(e),r=l[e].replace(/<.*?>/gi,"");if(isNaN(r)&&judgeSearchType(r)!=config.search.CART&&judgeSearchType(r)!=config.search.REEL&&!isDateTime(r)){var o=$(t).find('thead th[data-column-index="'+e+'"]').text(),s=$('<select class="select2"></select>').appendTo($(n.footer()).empty()).on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());n.search(e?"^"+e.replace("\\","")+"$":"",!0,!1).draw()}),d='<option value="">所有'+o+"</option>";n.data().unique().sort().each(function(e,t){(e=e.trim()).length>0&&(d+='<option value="'+e+'">'+e+"</option>")}),s.append(d);var c=i.columns[i.ColReorder[e]].search.search;c.length&&(c=c.substring(1,c.length-1).replace("\\",""),s.val(c))}}),initSelect2()}function a(e,a,n){var l,r=getDateRange(),i=a.title+"("+r.start+" - "+r.end+")";if(location.hash.indexOf("cart")>-1&&(i=""),l={bRetrieve:!0,language:c,lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"所有"]],pageLength:15,dom:n?"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>":"<'clear'>R<'row tbTools' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"share",autoPrint:!1,text:"分享",message:"统计时间:"+r.start+"~"+r.end+"<br>"+a.source+"<br>©成都印钞有限公司 技术质量部",title:a.title,exportOptions:{columns:":visible"},className:"btn blue sbold btn-outline"},{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"复制",className:"btn red sbold btn-outline"},{extend:"csvHtml5",className:"btn green sbold btn-outline ",text:"txt",fieldBoundary:"",escapeChar:"",extension:".txt",header:a.cols>1,exportOptions:{columns:":visible"},filename:i,charset:"ANSI"},{extend:"excelHtml5",className:"btn yellow sbold btn-outline ",exportOptions:{columns:":visible"},filename:i},{extend:"csvHtml5",className:"btn purple sbold btn-outline ",filedBoundary:" ",escapeChar:" ",exportOptions:{columns:":visible"},filename:i},{extend:"print",autoPrint:!0,text:"打印",message:"统计时间:"+r.start+"~"+r.end+"<br>"+a.source+"<br>©成都印钞有限公司 技术质量部",title:a.title,exportOptions:{columns:":visible"},className:"btn grey-mint sbold btn-outline"},{extend:"colvis",text:'隐藏数据列<i class="fa fa-angle-down"></i>',className:"btn green-haze sbold btn-outline"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,bScrollInfinite:!0,aoColumns:a.header,data:a.data,searchHighlight:!0,colReorder:{realtime:!0},scroolY:"70v",scrollCollapse:!0,iStateDuration:604800,fnStateSaveCallback:function(e,t){var a=p[e.sInstance.replace("DataTables_Table_","")];try{(-1===e.iStateDuration?sessionStorage:localStorage).setItem("DataTables"+location.pathname+"/"+a,JSON.stringify(t))}catch(e){}},fnStateLoadCallback:function(e){var t=p[e.sInstance.replace("DataTables_Table_","")];try{return JSON.parse((-1===e.iStateDuration?sessionStorage:localStorage).getItem("DataTables"+location.pathname+"/"+t))}catch(e){}},initComplete:function(a){var n=this.api();n.on("click","tbody td",function(){0==$(this).find("a").length&&n.search(this.innerText.trim()).draw()}),$(e).parents(".portlet").find(".tools").append($(e).parents(".portlet").find(".tabletools-btn-group").clone(!0)),$(e).parents(".portlet").find(".tbTools").remove(),t(this,e)}},n&&(l.fixedHeader={header:!0,footer:!0,headerOffset:a.fixedHeaderOffset}),loadPDF){var o=getUrlParam("orient"),s=getUrlParam("pdfsize");null===o||"v"==o?o="portrit":"h"==o&&(o="landscape");var d={extend:"pdfHtml5",orientation:o,pageSize:s=null===s?"A4":"A3",message:"统计时间:"+r.start+" ~ "+r.end+"\n"+a.source+" - 成都印钞有限公司 技术质量部",title:a.title,exportOptions:{columns:":visible"},download:"open",className:"btn dark sbold btn-outline",filename:a.title+"("+r.start+" - "+r.end+")"};null!==getUrlParam("download")&&(d.download="download"),l.buttons.splice(4,0,d)}return l}function n(e){return e.split("eq(")[1].replace(")","")}function l(e,t,l){var r=$(e),i=0;App.getViewPort().width<App.getResponsiveBreakpoint("md")?$(".page-header").hasClass("page-header-fixed-mobile")&&(i=$(".page-header").outerHeight(!0)):$(".page-header").hasClass("navbar-fixed-top")&&(i=$(".page-header").outerHeight(!0)),t.fixedHeaderOffset=i;var o=a(e,t,l),s="";t.header.map(function(e){s+="<td></td>"}),r.find("tfoot tr").html(s);var c=n(e);d[c]=r.dataTable(o)}function r(e){if(e.find("tbody").length>0){var t=e.dataTable();t.fnClearTable(t)}}function i(e){var t=[],a=0,n={cart:/^[1-9]\d{3}[A-Za-z]\d{3}$/,reel:/^[1-9]\d{6}[A-Ca-c]$|^[1-9]\d{4}[A-Ca-c]$|^[1-9]\d{6}$/};return e.data[0].map(function(e,l){e=""+e,n.cart.test(e)?(a=0,t.push(l)):n.reel.test(e)&&(a=1,t.push(l))}),t.length&&(e.data=e.data.map(function(e){return t.map(function(t){e[t]=getCartOrReelStr(e[t],a)}),e})),e}function o(e,a,o){var s=$(a),c=e.title;if(location.hash.indexOf("cart")>-1&&(c=location.hash.replace("#cart=","").toUpperCase()+" "+e.title),s.parents(".portlet").find('[name="TableTitle"]').text(c),s.parents(".portlet").find('[name="datasource"]').text("("+e.source+")"),r(s),e.rows>0)if(e=i(e),s.find("tbody").length){for(var p=n(a),u=d[p].fnSettings(),f=0;f<e.rows;f++)d[p].oApi._fnAddData(u,e.data[f]);t(d[p],a),u.aiDisplay=u.aiDisplayMaster.slice(),d[p].fnDraw()}else l(a,e,o);else bsTips("该时间范围内无质量数据，请重新选择查询时间!",1)}function s(e,t,a){void 0===a&&(a=!0),$.ajax({url:t}).done(function(t){o(t=handleAjaxData(t),e,a),config.info.qualitytable||(config.info.qualitytable=!0,bsTips("数据加载完成",1))})}var d=[],c={sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 项结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",sInfoEmpty:"显示第 0 至 0 项结果，共 0 项",sInfoFiltered:"(由 _MAX_ 项结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},p=[];return null!==getUrlParam("tid")&&(p=getUrlParam("tid").split(",")),{init:function(){$(document).on("click",".ranges li:not(:last),button.applyBtn",function(){e(0)}),$("#multi").on("click","a",function(){e(0)}),initProd(),null!==getUrlParam("tid")&&e(1),$(window).bind("hashchange",function(){e(1)}),$("#Preview .btn").on("click",function(){s('[name="sampleTable"]',$("#Preview input").val())})}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(),hideSidebarTool(),1==location.hash.indexOf("cart")&&infoTips("请在上方搜索栏中输入车号以查询该车号相关数据"),null!==loadPDF?(require.config({baseUrl:"assets/global/plugins/datatables/media/js/",paths:{pdfmake:"pdfmake.min",vfs_fonts:"vfs_fonts"}}),require(["pdfmake","vfs_fonts"],function(){dataTable.init()})):dataTable.init();new ClipboardJS("#share button");1==App.getURLParameter("debug")||null===App.getURLParameter("tid")?$("#Preview").show():$("#Preview").hide(),null!==App.getURLParameter("multi")?$("#multi").show():$("#multi").hide()}),jQuery(window).resize(function(){HeadFix()});