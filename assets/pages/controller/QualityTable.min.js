function GetJsonUrl(e){var t=getDateRange(),a=window.location.href.split("?")[1].split("&"),n="";a.map(function(e,t){"tid="!==jsLeft(e,4)&&(n+="&"+e)});var o=getUrlParam("token");null==o&&(o=config.TOKEN);var r=getRootPath()+"/DataInterface/Api?Token="+o+"&ID="+e+"&M=3&tstart="+t.start+"&tend="+t.end+"&tstart2="+t.start+"&tend2="+t.end+"&tstart3="+t.start+"&tend3="+t.end+"&tstart4="+t.start+"&tend4="+t.end+n+"&cache="+config.cache;return r}$("#HideTips").on("click",function(){$(this).parent().hide()});var dataTable=function(){function e(e){var t;if(1==App.getURLParameter("debug")||null===App.getURLParameter("tid"))$("#Preview").show(),t=$("#Preview input").val(),o('[name="sampleTable"]',t);else{var a,n={id:getUrlParam("tid").split(","),fixheader:null===getUrlParam("fixheader")?["1"]:getUrlParam("fixheader").split(",")},r=n.id.length;if(r>1&&e){var l=$('[name="sampleTable"]').parents(".portlet:nth(0)");for(a=0;a<r-1;a++)l.parent().append(l.clone())}for(config.info.qualitytable=!1,a=0;a<r;a++)objRequest={url:GetJsonUrl(n.id[a]),fixheader:"1"==handleParam(n.fixheader,a,"1")},"0"==objRequest.fixheader&&$('[name="sampleTable"]:eq('+a+")").removeClass("table-header-fixed").addClass("dt-responsive"),o('[name="sampleTable"]:eq('+a+")",objRequest.url,objRequest.fixheader)}}function t(e,t,a){var n,o=getDateRange(),r=getUrlParam("tid").split(",");return n={bRetrieve:!0,language:i,lengthMenu:[[5,10,15,20,50,100,-1],[5,10,15,20,50,100,"所有"]],pageLength:15,dom:a?"<'row tbTools' <'col-md-6 col-sm-12 pull-right'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>>t<'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>":"<'clear'>R<'row tbTools' <'col-md-12'B>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",buttons:[{extend:"share",autoPrint:!1,text:"分享",message:"统计时间:"+o.start+"~"+o.end+"<br>"+t.source+"<br>©成都印钞有限公司 技术质量部",title:t.title,exportOptions:{columns:":visible"},className:"btn blue sbold btn-outline"},{extend:"copyHtml5",exportOptions:{columns:":visible"},text:"复制",className:"btn red sbold btn-outline"},{extend:"excelHtml5",className:"btn yellow sbold btn-outline ",exportOptions:{columns:":visible"},filename:t.title+"("+o.start+" - "+o.end+")"},{extend:"csvHtml5",className:"btn purple sbold btn-outline ",exportOptions:{columns:":visible"},filename:t.title+"("+o.start+" - "+o.end+")"},{extend:"print",autoPrint:!0,text:"打印",message:"统计时间:"+o.start+"~"+o.end+"<br>"+t.source+"<br>©成都印钞有限公司 技术质量部",title:t.title,exportOptions:{columns:":visible"},className:"btn grey-mint sbold btn-outline"},{extend:"colvis",text:'隐藏数据列<i class="fa fa-angle-down"></i>',className:"btn green-haze sbold btn-outline"}],bDeferRender:!0,bProcessing:!0,bStateSave:!0,bserverSide:!1,bInfo:!0,bAutoWidth:!0,bSortClasses:!1,bScrollInfinite:!0,aoColumns:t.header,data:t.data,searchHighlight:!0,colReorder:{realtime:!0},scroolY:"70v",scrollCollapse:!0,iStateDuration:604800,fnStateSaveCallback:function(e,t){var a=r[e.sInstance.replace("DataTables_Table_","")];try{(e.iStateDuration===-1?sessionStorage:localStorage).setItem("DataTables"+location.pathname+"/"+a,JSON.stringify(t))}catch(e){}},fnStateLoadCallback:function(e){var t=r[e.sInstance.replace("DataTables_Table_","")];try{return JSON.parse((e.iStateDuration===-1?sessionStorage:localStorage).getItem("DataTables"+location.pathname+"/"+t))}catch(e){}},initComplete:function(t){var a=this.api();a.on("click","tbody td",function(){a.search(this.innerText.trim()).draw()}),$(e).parents(".portlet").find(".tools").append($(e).parents(".portlet").find(".tabletools-btn-group").clone(!0)),$(e).parents(".portlet").find(".tbTools").remove();var n=a.row(0).data(),o=r[t.sInstance.replace("DataTables_Table_","")],l=$.parseJSON(localStorage.getItem("DataTables/qualitytable/"+o));a.columns().indexes().flatten().each(function(t){var o=a.column(t),r=n[t];if(isNaN(r)&&judgeSearchType(r)!=config.search.CART&&judgeSearchType(r)!=config.search.REEL){var i=$(e).find('thead th[data-column-index="'+t+'"]').text(),s=$('<select class="select2"><option value="">所有'+i+"</option></select>").appendTo($(o.footer()).empty()).on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());o.search(e?"^"+e.replace("\\","")+"$":"",!0,!1).draw()}),d="";o.data().unique().sort().each(function(e,t){d+='<option value="'+e+'">'+e+"</option>"}),s.append(d);var c=l.columns[l.ColReorder[t]].search.search;c.length&&(c=c.substring(1,c.length-1).replace("\\",""),s.val(c))}}),initSelect2()}},a&&(n.fixedHeader={header:!0,footer:!0,headerOffset:t.fixedHeaderOffset}),n}function a(e,a,n){var o=$(e),l=0;App.getViewPort().width<App.getResponsiveBreakpoint("md")?$(".page-header").hasClass("page-header-fixed-mobile")&&(l=$(".page-header").outerHeight(!0)):$(".page-header").hasClass("navbar-fixed-top")&&(l=$(".page-header").outerHeight(!0)),a.fixedHeaderOffset=l;var i=t(e,a,n),s="";a.header.map(function(e){s+="<td></td>"}),o.find("tfoot tr").html(s),r=o.dataTable(i)}function n(e,t,n){var o=$(t);if(o.parents(".portlet").find('[name="TableTitle"]').text(e.title),o.parents(".portlet").find('[name="datasource"]').text("("+e.source+")"),e.cols<2)return void bsTips("请确保数据列在2列以上，当前为："+e.cols);if(!(e.rows>0))return void bsTips("该时间范围内无质量数据，请重新选择查询时间!",1);if(!o.find("tbody").length)return void a(t,e,n);r=o.dataTable(),r.fnClearTable(this);for(var l=r.fnSettings(),i=0;i<e.rows;i++)r.oApi._fnAddData(l,e.data[i]);l.aiDisplay=l.aiDisplayMaster.slice(),r.fnDraw()}function o(e,t,a){"undefined"==typeof a&&(a=!0),$.ajax({url:t}).done(function(t){t=$.parseJSON(t),n(t,e,a),config.info.qualitytable||(config.info.qualitytable=!0,bsTips("数据加载完成",1))})}var r,l=function(){return{sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 项结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",sInfoEmpty:"显示第 0 至 0 项结果，共 0 项",sInfoFiltered:"(由 _MAX_ 项结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}}},i=l();return{init:function(){$(document).on("click",".ranges li:not(:last),button.applyBtn",function(){e(0)}),null!==getUrlParam("tid")&&e(1),$("#Preview .btn").on("click",function(){o('[name="sampleTable"]',$("#Preview input").val())})}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(),hideSidebarTool(),dataTable.init();new Clipboard("#share button");1==App.getURLParameter("debug")||null===App.getURLParameter("tid")?$("#Preview").show():$("#Preview").hide()}),jQuery(window).resize(function(){HeadFix()});