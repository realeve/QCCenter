var FakePiece=function(){function e(){$("input[name='rec_date']").val(today(7)),$("input[name='remark']").val("无");var e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=24&M=3&t=1";$.ajax({url:e}).done(function(e){var t=handleAjaxData(e);InitSelect("prod_id",t)}),$(".page-header .dropdown-quick-sidebar-toggler").hide(),c()}function t(){$(".formData input").val("0"),$("[name='remark']").val("无")}function a(){var e=getRootPath()+"/DataInterface/insert",a=getFormData("theForm");a.tbl=TBL.PPR_FALSEWASTE,a.month=$("input[name='rec_date']").val().replace(/-/g,""),a.utf2gbk=["remark"],a.rec_date=today(6);var r={url:e,type:"post",resetForm:!0,data:a,success:function(e){var a=$.parseJSON(e);bsTips(a.message,a.type),t(),n()},error:function(e){infoTips(JSON.stringify(e))}};Number.parseInt(a.checkNum)>=Number.parseInt(a.wasteNum)?$.ajax(r):(bsTips("数据无效，误废张数大于抽检张数，请检查后重新输入！"),$('[name="checkNum"]').focus())}function n(){function e(e,t){var a="<tr>\t<td>"+t+"</td>";return e.map(function(e){a+="\t<td>"+e+"</td>"}),a+="</tr>"}var t=$('[name="hisData"] tbody'),a=$("input[name='rec_date']").val();a=jsLeft(a,4);var n=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=247&M=3&tstart="+a;$.ajax({url:n}).done(function(a){if(a=handleAjaxData(a),0===a.rows)return void t.html('<tr><td class="text-center" colspan='+(a.cols+1)+">指定时间内无数据</td></tr>");var n="";a.data.map(function(t,a){n+=e(t,a+1)}),t.html(n)})}function r(){var e=$("input[name='rec_date']").val();e=jsLeft(e,4);var t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=249&M=3&tstart="+e;return t}function i(){var e={url:r(),type:"line",background:"img"};require(["../assets/pages/controller/singleChart.min"],function(t){t.init(e,$('[name="singleChart"]'))})}var o=function(){jQuery().datepicker&&$(".date-picker-month").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"yyyy-mm",minViewMode:1,maxViewMode:3})},c=function(){var e=getValidateRule("theForm");e.rec_date.number=!1,e.checkNum={digits:!0,required:!0,min:1},e.wasteNum={digits:!0,required:!0,min:0},$("form[name=theForm]").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!0,rules:e,highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},submitHandler:function(e){a()}})};return $('[name="reset"]').on("click",function(){t()}),$('[name="checkNum"],[name="wasteNum"]').on("keyup",function(){var e,t=$('[name="checkNum"]').val(),a=$('[name="wasteNum"]').val();a&&t>0&&(e=100*a/t,e=e.toFixed(3),$('[name="wasteRatio"]').val(e))}),{init:function(){o(),e(),i(),n()}}}();jQuery(document).ready(function(){initDom(),FakePiece.init()}),jQuery(window).resize(function(){HeadFix()});