var feedback=function(){var a={},e=!1,t=function(){var e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=35&M=3",t=ReadData(e);InitSelect("prodType",t),$("[name=prodType] option").first().text("所有品种"),e=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=36&M=3&p=2",t=ReadData(e),InitSelect("machineID",t),$("[name=machineID] option").first().text("所有机台");for(var i=100;i>0;i-=10)$("#limit").append("<option value="+i+">"+i+"</option>");"undefined"!=typeof localStorage.searchFeedBack?(a=$.parseJSON(localStorage.searchFeedBack),$("[name=machineID]").val(a.machineID),$("#limit").val(a.limit)):($("#limit").val(70),$("[name=machineID]").val(-1)),n()},i=function(){return{machineID:$("[name=machineID]").val(),limit:$("#limit").val()}},c=function(){a=i(),localStorage.searchFeedBack=JSON.stringify(a)};$("#saveSettings").on("click",function(){c(),$(".page-quick-sidebar-toggler").click()});var r=function(a){var e="&ID=";return e+=-1==a.machineID?279:"280&mid="+a.machineID},n=function(){var e=getDateRange();a=i();var t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&M=0&tstart="+e.start+"&tend="+e.end+"&limit="+a.limit+"&faketype="+a.fakeType;t+=r(a);var c=ReadData(t);o(c)},o=function(a){var e=[{"class":"",filter:"none"},{"class":"badge-info",filter:"notfake"},{"class":"badge-danger",filter:"fake"}],t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&blob=1&ID=254&M=3&t=";$("#js-grid-juicy-projects").html("");a.rows>0?(a.data.map(function(a,i){for(var c=t+a.id,r=ReadData(c),n=r.data[0],o=JSON.stringify(a),s=JSON.stringify(n),l=1;3>=l;l++){var d=parseInt(a["ImgVerify"+l],10);d=d>2?2:d;var p='<div class="cbp-item '+a.ProductName+" "+e[d].filter+'">  <div class="cbp-caption">      <div class="cbp-caption-defaultWrap">          <img src="data:image/jpg;base64,'+n[l-1]+'" alt=""> </div>      <div class="cbp-caption-activeWrap">          <div class="cbp-l-caption-alignCenter">              <div class="cbp-l-caption-body">                  <a href="../assets/pages/controller/data/ajax/feedback.html?cart='+a.CartNumber+'" class="cbp-singlePage cbp-s-caption-buttonLeft btn red uppercase"  rel="nofollow" data-cartnumber="'+a.CartNumber+"\"  data-cart='"+o+"' data-img = '"+s+"' >查看详情</a>                  <a href=\"data:image/jpg;base64,"+n[l-1]+'" class="cbp-lightbox cbp-s-caption-buttonRight btn red uppercase" data-title="'+a.CartNumber+"<br>"+a.MachineName+"<br>好品率："+a.GoodRate+'%">查看大图</a>              </div>          </div>      </div>  </div>  <div class="cbp-l-grid-agency-title uppercase text-center">'+a.CartNumber+'</div>  <div class="cbp-l-grid-agency-desc uppercase text-center">第'+a["FormatPos"+l]+'开 / <span class="badge '+e[d]["class"]+'">'+a["ErrCount"+l]+"条 </span></div></div>";"AA=="!=n[l-1]&&$("#js-grid-juicy-projects").append(p)}}),bsTips("图像数据载入完毕,共载入数据"+a.rows+"车",1),s()):$("#js-grid-juicy-projects").addClass("cbp-ready").append('<div class="cbp-search-nothing">当前时间内无 <i>'+$("[name=machineID]").find("option:selected").text()+"</i> 的信息</div>")},s=function(){var a=function(){$("#js-grid-juicy-projects").cubeportfolio({filters:"#js-filters-juicy-projects,#js-filters-juicy-projects2",search:"#js-search-blog-posts",layoutMode:"grid",defaultFilter:"*",animationType:"quicksand",gapHorizontal:35,gapVertical:30,gridAdjustment:"responsive",mediaQueries:[{width:1500,cols:7},{width:1100,cols:6},{width:800,cols:5},{width:480,cols:3},{width:320,cols:2}],caption:"overlayBottomReveal",displayType:"sequentially",displayTypeSpeed:20,lightboxDelegate:".cbp-lightbox",lightboxGallery:!0,lightboxTitleSrc:"data-title",lightboxCounter:'<div class="cbp-popup-lightbox-counter">{{current}} of {{total}}</div>',singlePageDelegate:".cbp-singlePage",singlePageDeeplinking:!0,singlePageStickyNavigation:!0,singlePageCounter:'<div class="cbp-popup-singlePage-counter">{{current}} of {{total}}</div>',singlePageCallback:function(a,e){var t=this,i=['<span class="badge">','<span class="badge badge-info">','<span class="badge badge-danger">'];$.ajax({url:a,type:"GET",dataType:"html",timeout:1e4}).done(function(a){var e=location.href.split("?cart=")[1].substring(0,8),c=$('[data-cartnumber="'+e+'"]').first(),r=c.data("cart"),n=c.data("img");a=a.replace("{cartnumber}",r.CartNumber),a=a.replace(/{machine}/g,r.MachineName),a=a.replace("{goodrate}",r.GoodRate),a=a.replace(/{date}/g,r.ProduceDate),a=a.replace(/{errcount}/g,r.errpiccount),a=a.replace(/{nocheck}/g,r.nocheckcount);for(var o=0;3>o;o++)if("AA=="!=n[o]){a=a.replace('a href=""','a href="data:image/jpg;base64,'+n[o]+'"'),a=a.replace('img src=""','img src="data:image/jpg;base64,'+n[o]+'"');var s=parseInt(r["ImgVerify"+(o+1)],10);s=s>2?2:s,a=a.replace("{img"+o+"}","第"+r["FormatPos"+(o+1)]+"开"),a=a.replace("{errcount"+o+"}",i[s]+r["ErrCount"+(o+1)]+"条</span>")}else a=a.replace("{img"+o+"}","");var l={xAxis:[],yAxis:[]},d=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=281&M=3&mid="+r.id;$.ajax(d).done(function(e){e=e.replace(/\r\n/g,"<br>").replace(/\t/g," ");var c=$.parseJSON(e),n="";c.data.map(function(a,e){n+='<div class="cbp-l-project-desc-title '+(e>0?"margin-top-40":"")+'">	<span>'+(e+1)+"."+a[0]+"工序：  "+a[1]+'</span><h5 class="pull-right" style="margin-top:15px;">'+a[3].substring(0,16)+'</h5></div><div class="cbp-l-project-desc-text"><p style="margin-bottom:5px;">'+a[4]+'</p><h5 class="pull-right">——— <i>'+a[2]+"</i></h5></div>"}),a=a.replace("{prodInfo}",n);var o=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=282&M=3&cart="+r.CartNumber,s=ReadData(o),d="";s.data.map(function(a,e){e++;var t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&blob=1&ID=254&M=3&t="+a[0],c=ReadData(t),r=c.data[0],o=parseInt(a[5],10);o=o>2?2:o;var s;s="AA=="!==r[0]?'        <img src="data:image/jpg;base64,'+r[0]+'" alt="">':'        <img src="../assets/global/img/none.png" alt="">',n='<div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">	<div class="portlet light portlet-fit bordered">		<div class="portlet-title">			<div class="caption">				<i class="icon-layers font-green"></i>				<span class="caption-subject font-green bold uppercase">'+a[1]+'</span>				<div class="caption-desc font-grey-cascade"> 好品率 : '+a[2]+'%</div>			</div>		</div>		<div class="portlet-body">			<div class="mt-element-overlay">				<div class="row">					<div class="col-md-12">						<div class="mt-overlay-2">'+s+'							<div class="mt-overlay">								<h2>第'+a[3]+"开 / "+i[o]+a[4]+'条</span></h2>								<a class="mt-info btn red btn-outline" href="#">查看详情</a>							</div>						</div>					</div>				</div>			</div>		</div>	</div></div>',d+=n,l.xAxis.push(a[1]),l.yAxis.push(a[2]),l.type="line"}),a=a.replace("{relate}",d),t.updateSinglePage(a),setTimeout(function(){var a=echarts.init(document.getElementById("chart")),e=getSimpleEChart(l);a.setOption(e)},500)})}).fail(function(){t.updateSinglePage("AJAX Error! Please refresh the page!")})}},function(){bsTips("数据渲染完毕",1)})};e?$("#js-grid-juicy-projects").cubeportfolio("destroy",a):a(),e=!0};return{init:function(){$(document).on("click",".ranges li:not(:last),button.applyBtn",function(){n()}),t()}}}();jQuery(document).ready(function(){whiteBackground(),RoundedTheme(0),UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(),feedback.init(),infoTips("详情页面需增加相应车号链接及实废图像链接")}),jQuery(window).resize(function(){HeadFix()});