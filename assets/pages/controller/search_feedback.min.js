var feedback=function(){var e={},a=!1,t=function(){str=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=36&M=3&p=2&cache=14400",$.ajax({url:str}).done(function(e){e=handleAjaxData(e),InitSelect("machineID",e),$("[name=machineID] option").first().text("所有机台")});for(var e=100;e>0;e-=10)$("#limit").append("<option value="+e+">"+e+"</option>");var a={machineID:-1,limit:70};"undefined"!=typeof localStorage.searchFeedBack?(a=$.parseJSON(localStorage.searchFeedBack),$("[name=machineID]").val(a.machineID),$("#limit").val(a.limit)):(localStorage.searchFeedBack=JSON.stringify(a),$("#limit").val(70),$("[name=machineID]").val(-1)),o(a)},i=function(){return{machineID:$("[name=machineID]").val(),limit:$("#limit").val()}},n=function(){e=i(),localStorage.searchFeedBack=JSON.stringify(e)};$("#saveSettings").on("click",function(){n(),$(".page-quick-sidebar-toggler").click()});var r=function(e){var a="&ID=";return a+=-1==e.machineID?279:"280&mid="+e.machineID},o=function(e){e=e||i();var a=getDateRange(),t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&M=0&tstart="+a.start+"&tend="+a.end+"&limit="+e.limit;t+=r(e);var n=ReadData(t);c(n)},c=function(e){function a(){n==e.rows&&(bsTips("图像数据载入完毕,共载入数据"+e.rows+"车",1),$("#js-grid-juicy-projects").html(r),s())}var t=[{"class":"",filter:"none"},{"class":"badge-info",filter:"notfake"},{"class":"badge-danger",filter:"fake"}],i=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&blob=1&ID=254&cache=14400&M=3&t=";$("#js-grid-juicy-projects").html("");if(e.rows>0){var n=0,r="";e.data.map(function(e,o){var c=i+e.id;$.ajax({url:c}).done(function(i){i=handleAjaxData(i);for(var o=i.data[0],c=1;3>=c;c++)if("AA=="!=o[c-1]){var l=parseInt(e["ImgVerify"+c],10);l=l>2?2:l;var s={ProductName:e.ProductName,filter:t[l].filter,img:"data:image/jpg;base64,"+o[c-1],CartNumber:e.CartNumber,MachineName:e.MachineName,GoodRate:e.GoodRate,FormatPos:e["FormatPos"+c],imgType:t[l]["class"],ErrCount:e["ErrCount"+c]};r+=tpl.getHTML("feedback/imgitem.etpl",s)}n++,a()})})}else $("#js-grid-juicy-projects").addClass("cbp-ready").append('<div class="cbp-search-nothing"><h3>当前时间范围内无相关信息</h3></div>')},l=function(){function e(e){url=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=291&M=0&cart="+e;var a=ReadData(url),t=["","badge-info","badge-danger"],i=a.data[0];i.imglist=[];for(var n=1;3>=n;n++){var r=parseInt(i["ImgVerify"+n],10);r=r>2?2:r,i.imglist.push({formatPos:i["FormatPos"+n],errCount:i["ErrCount"+n],verify:t[r]})}return{id:a.data[0].id,html:tpl.getHTML("feedback/detail.etpl",i)}}function a(e){url=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=281&M=3&mid="+e,$.ajax(url).done(function(e){e=handleAjaxData(e),tpl.render("feedback/prodinfo.etpl",e,$('[name="prodInfo"]'))})}function t(e,a){a.content.html(e),a.content.addClass("cbp-popup-content").removeClass("cbp-popup-content-basic"),a.wrap.addClass("cbp-popup-ready"),a.wrap.removeClass("cbp-popup-loading")}function i(e){var a={xAxis:[],yAxis:[]},t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=282&M=3&cart="+e;$.ajax({url:t}).done(function(t){var i=handleAjaxData(t);tpl.render("feedback/hislist.etpl",i,$('[name="hislist"]')),i.data.map(function(t){r(t[0],t[1]==e),a.xAxis.push(t[1]),a.yAxis.push(t[2]),a.type="line"});var n=echarts.init(document.getElementById("chart")),o=getSimpleEChart(a);n.setOption(o)})}function n(e,a){var t=a.data[0][e];return t="AA=="==t?"../assets/global/img/none.png":"data:image/jpg;base64,"+t}function r(e,a){var t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&blob=1&ID=254&cache=14400&M=3&t="+e;$.ajax({url:t}).done(function(t){t=$.parseJSON(t);var i=n(0,t);$('.cbp-popup-wrap [name="hisImg'+e+'"]').attr("src",i),a&&($('.cbp-popup-wrap [name="img'+e+'_0"]').attr("src",i),$('.cbp-popup-wrap [name="img'+e+'_1"]').attr("src",n(1,t)),$('.cbp-popup-wrap [name="img'+e+'_2"]').attr("src",n(2,t)))})}return{renderProdInfo:a,renderDetail:e,renderHisQua:i,render:t}}(),s=function(){var e=function(){$("#js-grid-juicy-projects").cubeportfolio({filters:"#js-filters-juicy-projects,#js-filters-juicy-projects2",search:"#js-search-blog-posts",layoutMode:"grid",defaultFilter:"*",animationType:"quicksand",gapHorizontal:35,gapVertical:30,gridAdjustment:"responsive",mediaQueries:[{width:1500,cols:7},{width:1100,cols:6},{width:800,cols:5},{width:480,cols:3},{width:320,cols:2}],caption:"overlayBottomReveal",displayType:"sequentially",displayTypeSpeed:20,lightboxDelegate:".cbp-lightbox",lightboxGallery:!0,lightboxTitleSrc:"data-title",lightboxCounter:'<div class="cbp-popup-lightbox-counter">{{current}} of {{total}}</div>',singlePageDelegate:".cbp-singlePage",singlePageDeeplinking:!0,singlePageStickyNavigation:!0,singlePageCounter:'<div class="cbp-popup-singlePage-counter">{{current}} of {{total}}</div>',singlePageCallback:function(e,a){var t=this,i=l.renderDetail(e);l.render(i.html,t),l.renderProdInfo(i.id),l.renderHisQua(e)}},function(){bsTips("数据渲染完毕",1)})};a?$("#js-grid-juicy-projects").cubeportfolio("destroy",e):e(),a=!0};return{init:function(){var e=["feedback/imgitem.etpl","feedback/detail.etpl","feedback/prodinfo.etpl","feedback/hislist.etpl"];tpl.init(e,t),$(document).on("click",".ranges li:not(:last),button.applyBtn",function(){o()})}}}();jQuery(document).ready(function(){whiteBackground(),UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(),feedback.init()}),jQuery(window).resize(function(){HeadFix()});