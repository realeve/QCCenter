var feedback=function(){var e={},a=!1,t=function(){str=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=36&M=3&p=2&cache=14400",$.ajax({url:str}).done(function(e){e=handleAjaxData(e),InitSelect("machineID",e),$("[name=machineID] option").first().text("所有机台")});for(var e=100;e>0;e-=10)$("#limit").append("<option value="+e+">"+e+"</option>"),$("#errnum").append("<option value="+20*e+">"+20*e+"</option>");var a={machineID:-1,limit:70,errnum:1e3};"undefined"!=typeof localStorage.searchFeedBack?(a=$.parseJSON(localStorage.searchFeedBack),$("[name=machineID]").val(a.machineID),$("#limit").val(a.limit),"undefined"==typeof a.errnum?($("#errnum").val(1e3),a.errnum=1e3,n()):$("#errnum").val(a.errnum)):(localStorage.searchFeedBack=JSON.stringify(a),$("#limit").val(70),$("#errnum").val(1e3),$("[name=machineID]").val(-1)),o(a)},r=function(){return{machineID:$("[name=machineID]").val(),limit:$("#limit").val(),errnum:$("#errnum").val()}},n=function(){e=r(),localStorage.searchFeedBack=JSON.stringify(e)};$("#saveSettings").on("click",function(){n(),$(".page-quick-sidebar-toggler").click()});var i=function(e){var a="&ID=";return a+=-1==e.machineID?279:"280&mid="+e.machineID},o=function(e){e=e||r();var a=getDateRange(),t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&M=0&tstart="+a.start+"&tend="+a.end+"&errnum1="+e.errnum+"&errnum2="+e.errnum+"&errnum3="+e.errnum+"&limit="+e.limit;t+=i(e);var n=ReadData(t);c(n)},c=function(e){function a(){if(i==e.rows){bsTips("图像数据载入完毕,共载入数据"+e.rows+"车",1);var a=$("#errnum").val();n=_.sortBy(n,["prod",function(e){return-parseInt(e.errnum,10)}]).map(function(e){return parseInt(e.errnum,10)>a?e.html:void 0}),$("#js-grid-juicy-projects").html(n.join("")),s()}}var t=[{"class":"",filter:"none"},{"class":"badge-info",filter:"notfake"},{"class":"badge-danger",filter:"fake"}],r=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&blob=1&ID=254&cache=14400&M=3&t=";$("#js-grid-juicy-projects").html("");var n=[];if(e.rows>0){var i=0;e.data.map(function(e,o){var c=r+e.id;$.ajax({url:c}).done(function(r){r=handleAjaxData(r);for(var o,c=r.data[0],l=1;3>=l;l++)if("AA=="!=c[l-1]){var s=parseInt(e["ImgVerify"+l],10);s=s>2?2:s;var p={ProductName:e.ProductName,filter:t[s].filter,img:"data:image/jpg;base64,"+c[l-1],CartNumber:e.CartNumber,MachineName:e.MachineName,GoodRate:e.GoodRate,FormatPos:e["FormatPos"+l],imgType:t[s]["class"],ErrCount:e["ErrCount"+l]};o=tpl.getHTML("feedback/imgitem.etpl",p),n.push({html:o,prod:p.ProductName,errnum:p.ErrCount})}i++,a()})})}else $("#js-grid-juicy-projects").addClass("cbp-ready").append('<div class="cbp-search-nothing"><h3>当前时间范围内无相关信息</h3></div>')},l=function(){function e(e){url=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=291&M=0&cart="+e;var a=ReadData(url),t=["","badge-info","badge-danger"],r=a.data[0];r.imglist=[];for(var n=1;3>=n;n++){var i=parseInt(r["ImgVerify"+n],10);i=i>2?2:i,r.imglist.push({formatPos:r["FormatPos"+n],errCount:r["ErrCount"+n],verify:t[i]})}return{id:a.data[0].id,html:tpl.getHTML("feedback/detail.etpl",r)}}function a(e){url=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=281&M=3&mid="+e,$.ajax(url).done(function(e){e=handleAjaxData(e),tpl.render("feedback/prodinfo.etpl",e,$('[name="prodInfo"]'))})}function t(e,a){a.content.html(e),a.content.addClass("cbp-popup-content").removeClass("cbp-popup-content-basic"),a.wrap.addClass("cbp-popup-ready"),a.wrap.removeClass("cbp-popup-loading")}function r(e){var a={xAxis:[],yAxis:[]},t=getRootPath(1)+"/DataInterface/Api?Token="+config.TOKEN+"&ID=282&M=3&cart="+e;$.ajax({url:t}).done(function(t){var r=handleAjaxData(t);tpl.render("feedback/hislist.etpl",r,$('[name="hislist"]')),r.data.map(function(t){i(t[0],t[1]==e),a.xAxis.push(t[1]),a.yAxis.push(t[2])}),a.type="line";var n=echarts.init(document.getElementById("chart")),o=getSimpleEChart(a);n.setOption(o)})}function n(e,a){var t=a.data[0][e];return t="AA=="==t?"../assets/global/img/none.png":"data:image/jpg;base64,"+t}function i(e,a){var t=getRootPath()+"/DataInterface/Api?Token="+config.TOKEN+"&blob=1&ID=254&cache=14400&M=3&t="+e;$.ajax({url:t}).done(function(t){t=$.parseJSON(t);var r=n(0,t);$('.cbp-popup-wrap [name="hisImg'+e+'"]').attr("src",r),a&&($('.cbp-popup-wrap [name="img'+e+'_0"]').attr("src",r),$('.cbp-popup-wrap [name="img'+e+'_1"]').attr("src",n(1,t)),$('.cbp-popup-wrap [name="img'+e+'_2"]').attr("src",n(2,t)))})}return{renderProdInfo:a,renderDetail:e,renderHisQua:r,render:t}}(),s=function(){var e=function(){$("#js-grid-juicy-projects").cubeportfolio({filters:"#js-filters-juicy-projects,#js-filters-juicy-projects2",search:"#js-search-blog-posts",layoutMode:"grid",defaultFilter:"*",animationType:"quicksand",gapHorizontal:35,gapVertical:30,gridAdjustment:"responsive",mediaQueries:[{width:1500,cols:7},{width:1100,cols:6},{width:800,cols:5},{width:480,cols:3},{width:320,cols:2}],caption:"overlayBottomReveal",displayType:"default",lightboxDelegate:".cbp-lightbox",lightboxGallery:!0,lightboxTitleSrc:"data-title",lightboxCounter:'<div class="cbp-popup-lightbox-counter">{{current}} of {{total}}</div>',singlePageDelegate:".cbp-singlePage",singlePageDeeplinking:!0,singlePageStickyNavigation:!0,singlePageCounter:'<div class="cbp-popup-singlePage-counter">{{current}} of {{total}}</div>',singlePageCallback:function(e,a){var t=this,r=l.renderDetail(e);l.render(r.html,t),l.renderProdInfo(r.id),l.renderHisQua(e)}},function(){bsTips("数据渲染完毕",1)})};a?$("#js-grid-juicy-projects").cubeportfolio("destroy",e):e(),a=!0};return{init:function(){var e=["feedback/imgitem.etpl","feedback/detail.etpl","feedback/prodinfo.etpl","feedback/hislist.etpl"];tpl.init(e,t),$(document).on("click",".ranges li:not(:last),button.applyBtn",function(){o()})}}}();jQuery(document).ready(function(){whiteBackground(),UIIdleTimeout.init(),initDashboardDaterange("YYYYMMDD"),initDom(0),feedback.init(),bsTips("接口279，280需增加缺陷条数限制")});
//# sourceMappingURL=search_feedback.min.js.map